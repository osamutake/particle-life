(()=>{var __defProp=Object.defineProperty;var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:true})};var riot_exports={};__export(riot_exports,{__:()=>__,component:()=>component,install:()=>install,mount:()=>mount,pure:()=>pure,register:()=>register,uninstall:()=>uninstall,unmount:()=>unmount,unregister:()=>unregister,version:()=>version,withTypes:()=>withTypes});var COMPONENTS_IMPLEMENTATION_MAP=new Map;var DOM_COMPONENT_INSTANCE_PROPERTY=Symbol("riot-component");var PLUGINS_SET=new Set;var IS_DIRECTIVE="is";var MOUNT_METHOD_KEY="mount";var UPDATE_METHOD_KEY="update";var UNMOUNT_METHOD_KEY="unmount";var SHOULD_UPDATE_KEY="shouldUpdate";var ON_BEFORE_MOUNT_KEY="onBeforeMount";var ON_MOUNTED_KEY="onMounted";var ON_BEFORE_UPDATE_KEY="onBeforeUpdate";var ON_UPDATED_KEY="onUpdated";var ON_BEFORE_UNMOUNT_KEY="onBeforeUnmount";var ON_UNMOUNTED_KEY="onUnmounted";var PROPS_KEY="props";var STATE_KEY="state";var SLOTS_KEY="slots";var ROOT_KEY="root";var IS_PURE_SYMBOL=Symbol("pure");var IS_COMPONENT_UPDATING=Symbol("is_updating");var PARENT_KEY_SYMBOL=Symbol("parent");var ATTRIBUTES_KEY_SYMBOL=Symbol("attributes");var TEMPLATE_KEY_SYMBOL=Symbol("template");var ATTRIBUTE=0;var EVENT=1;var TEXT=2;var VALUE=3;var expressionTypes={ATTRIBUTE,EVENT,TEXT,VALUE};function camelToDashCase(string){return string.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function dashToCamelCase(string){return string.replace(/-(\w)/g,(_,c)=>c.toUpperCase())}function panic(message,cause){throw new Error(message,{cause})}function memoize(fn){const cache=new Map;const cached=val=>{return cache.has(val)?cache.get(val):cache.set(val,fn.call(this,val))&&cache.get(val)};cached.cache=cache;return cached}function evaluateAttributeExpressions(attributes){return attributes.reduce((acc,attribute)=>{const{value,type}=attribute;switch(true){case(!attribute.name&&type===ATTRIBUTE):return Object.assign({},acc,value);case type===VALUE:acc.value=attribute.value;break;default:acc[dashToCamelCase(attribute.name)]=attribute.value}return acc},{})}function checkType(element,type){return typeof element===type}function isSvg(el){const owner=el.ownerSVGElement;return!!owner||owner===null}function isTemplate(el){return el.tagName.toLowerCase()==="template"}function isFunction(value){return checkType(value,"function")}function isBoolean(value){return checkType(value,"boolean")}function isObject(value){return!isNil(value)&&value.constructor===Object}function isNil(value){return value===null||value===void 0}function noop(){return this}function autobindMethods(source,methods){methods.forEach(method=>{source[method]=source[method].bind(source)});return source}function callOrAssign(source){return isFunction(source)?source.prototype&&source.prototype.constructor?new source:source():source}var PURE_COMPONENT_API=Object.freeze({[MOUNT_METHOD_KEY]:noop,[UPDATE_METHOD_KEY]:noop,[UNMOUNT_METHOD_KEY]:noop});var MOCKED_TEMPLATE_INTERFACE=Object.assign({},PURE_COMPONENT_API,{clone:noop,createDOM:noop});function DOMattributesToObject(element){return Array.from(element.attributes).reduce((acc,attribute)=>{acc[dashToCamelCase(attribute.name)]=attribute.value;return acc},{})}function moveChildren(source,target){while(source.firstChild)target.appendChild(source.firstChild)}function cleanNode(node){while(node.firstChild)node.removeChild(node.firstChild)}function clearChildren(children){for(let i=0;i<children.length;i++)removeChild(children[i])}var removeChild=node=>node.remove();var insertBefore=(newNode,refNode)=>refNode&&refNode.parentNode&&refNode.parentNode.insertBefore(newNode,refNode);var replaceChild=(newNode,replaced)=>replaced&&replaced.parentNode&&replaced.parentNode.replaceChild(newNode,replaced);var EACH=0;var IF=1;var SIMPLE=2;var TAG=3;var SLOT=4;var bindingTypes={EACH,IF,SIMPLE,TAG,SLOT};function defineProperty(source,key,value,options){if(options===void 0){options={}}Object.defineProperty(source,key,Object.assign({value,enumerable:false,writable:false,configurable:true},options));return source}function defineProperties(source,properties,options){Object.entries(properties).forEach(_ref=>{let[key,value]=_ref;defineProperty(source,key,value,options)});return source}function defineDefaults(source,defaults){Object.entries(defaults).forEach(_ref2=>{let[key,value]=_ref2;if(!source[key])source[key]=value});return source}var HEAD_SYMBOL=Symbol();var TAIL_SYMBOL=Symbol();function createHeadTailPlaceholders(){const head=document.createTextNode("");const tail=document.createTextNode("");head[HEAD_SYMBOL]=true;tail[TAIL_SYMBOL]=true;return{head,tail}}function createTemplateMeta(componentTemplate){const fragment=componentTemplate.dom.cloneNode(true);const{head,tail}=createHeadTailPlaceholders();return{avoidDOMInjection:true,fragment,head,tail,children:[head,...Array.from(fragment.childNodes),tail]}}var udomdiff=(a2,b2,get2,before)=>{const bLength=b2.length;let aEnd=a2.length;let bEnd=bLength;let aStart=0;let bStart=0;let map=null;while(aStart<aEnd||bStart<bEnd){if(aEnd===aStart){const node=bEnd<bLength?bStart?get2(b2[bStart-1],-0).nextSibling:get2(b2[bEnd-bStart],0):before;while(bStart<bEnd)insertBefore(get2(b2[bStart++],1),node)}else if(bEnd===bStart){while(aStart<aEnd){if(!map||!map.has(a2[aStart]))removeChild(get2(a2[aStart],-1));aStart++}}else if(a2[aStart]===b2[bStart]){aStart++;bStart++}else if(a2[aEnd-1]===b2[bEnd-1]){aEnd--;bEnd--}else if(a2[aStart]===b2[bEnd-1]&&b2[bStart]===a2[aEnd-1]){const node=get2(a2[--aEnd],-1).nextSibling;insertBefore(get2(b2[bStart++],1),get2(a2[aStart++],-1).nextSibling);insertBefore(get2(b2[--bEnd],1),node);a2[aEnd]=b2[bEnd]}else{if(!map){map=new Map;let i=bStart;while(i<bEnd)map.set(b2[i],i++)}if(map.has(a2[aStart])){const index=map.get(a2[aStart]);if(bStart<index&&index<bEnd){let i=aStart;let sequence=1;while(++i<aEnd&&i<bEnd&&map.get(a2[i])===index+sequence)sequence++;if(sequence>index-bStart){const node=get2(a2[aStart],0);while(bStart<index)insertBefore(get2(b2[bStart++],1),node)}else{replaceChild(get2(b2[bStart++],1),get2(a2[aStart++],-1))}}else aStart++}else removeChild(get2(a2[aStart++],-1))}}return b2};var UNMOUNT_SCOPE=Symbol("unmount");var EachBinding={nodes:[],mount(scope,parentScope){return this.update(scope,parentScope)},update(scope,parentScope){const{placeholder,nodes,childrenMap}=this;const collection=scope===UNMOUNT_SCOPE?null:this.evaluate(scope);const items=collection?Array.from(collection):[];const{newChildrenMap,batches,futureNodes}=createPatch(items,scope,parentScope,this);udomdiff(nodes,futureNodes,patch(Array.from(childrenMap.values()),parentScope),placeholder);batches.forEach(fn=>fn());this.childrenMap=newChildrenMap;this.nodes=futureNodes;return this},unmount(scope,parentScope){this.update(UNMOUNT_SCOPE,parentScope);return this}};function patch(redundant,parentScope){return(item,info)=>{if(info<0){const element=redundant[redundant.length-1];if(element){const{template,nodes,context}=element;nodes.pop();if(!nodes.length){redundant.pop();template.unmount(context,parentScope,null)}}}return item}}function mustFilterItem(condition,context){return condition?!condition(context):false}function extendScope(scope,_ref){let{itemName,indexName,index,item}=_ref;defineProperty(scope,itemName,item);if(indexName)defineProperty(scope,indexName,index);return scope}function createPatch(items,scope,parentScope,binding){const{condition,template,childrenMap,itemName,getKey,indexName,root,isTemplateTag}=binding;const newChildrenMap=new Map;const batches=[];const futureNodes=[];items.forEach((item,index)=>{const context=extendScope(Object.create(scope),{itemName,indexName,index,item});const key=getKey?getKey(context):index;const oldItem=childrenMap.get(key);const nodes=[];if(mustFilterItem(condition,context)){return}const mustMount=!oldItem;const componentTemplate=oldItem?oldItem.template:template.clone();const el=componentTemplate.el||root.cloneNode();const meta=isTemplateTag&&mustMount?createTemplateMeta(componentTemplate):componentTemplate.meta;if(mustMount){batches.push(()=>componentTemplate.mount(el,context,parentScope,meta))}else{batches.push(()=>componentTemplate.update(context,parentScope))}if(isTemplateTag){nodes.push(...meta.children)}else{nodes.push(el)}childrenMap.delete(key);futureNodes.push(...nodes);newChildrenMap.set(key,{nodes,template:componentTemplate,context,index})});return{newChildrenMap,batches,futureNodes}}function create$6(node,_ref2){let{evaluate,condition,itemName,indexName,getKey,template}=_ref2;const placeholder=document.createTextNode("");const root=node.cloneNode();insertBefore(placeholder,node);removeChild(node);return Object.assign({},EachBinding,{childrenMap:new Map,node,root,condition,evaluate,isTemplateTag:isTemplate(root),template:template.createDOM(node),getKey,indexName,itemName,placeholder})}var IfBinding={mount(scope,parentScope){return this.update(scope,parentScope)},update(scope,parentScope){const value=!!this.evaluate(scope);const mustMount=!this.value&&value;const mustUnmount=this.value&&!value;const mount2=()=>{const pristine=this.node.cloneNode();insertBefore(pristine,this.placeholder);this.template=this.template.clone();this.template.mount(pristine,scope,parentScope)};switch(true){case mustMount:mount2();break;case mustUnmount:this.unmount(scope);break;default:if(value)this.template.update(scope,parentScope)}this.value=value;return this},unmount(scope,parentScope){this.template.unmount(scope,parentScope,true);return this}};function create$5(node,_ref3){let{evaluate,template}=_ref3;const placeholder=document.createTextNode("");insertBefore(placeholder,node);removeChild(node);return Object.assign({},IfBinding,{node,evaluate,placeholder,template:template.createDOM(node)})}var ElementProto=typeof Element==="undefined"?{}:Element.prototype;var isNativeHtmlProperty=memoize(name=>ElementProto.hasOwnProperty(name));function setAllAttributes(node,attributes){Object.entries(attributes).forEach(_ref4=>{let[name,value]=_ref4;return attributeExpression(node,{name},value)})}function removeAllAttributes(node,newAttributes,oldAttributes){const newKeys=newAttributes?Object.keys(newAttributes):[];Object.keys(oldAttributes).filter(name=>!newKeys.includes(name)).forEach(attribute=>node.removeAttribute(attribute))}function canRenderAttribute(value){return value===true||["string","number"].includes(typeof value)}function shouldRemoveAttribute(value){return!value&&value!==0}function attributeExpression(node,_ref5,value,oldValue){let{name}=_ref5;if(!name){if(oldValue){removeAllAttributes(node,value,oldValue)}if(value){setAllAttributes(node,value)}return}if(!isNativeHtmlProperty(name)&&(isBoolean(value)||isObject(value)||isFunction(value))){node[name]=value}if(shouldRemoveAttribute(value)){node.removeAttribute(name)}else if(canRenderAttribute(value)){node.setAttribute(name,normalizeValue(name,value))}}function normalizeValue(name,value){return value===true?name:value}var RE_EVENTS_PREFIX=/^on/;var getCallbackAndOptions=value=>Array.isArray(value)?value:[value,false];var EventListener={handleEvent(event){this[event.type](event)}};var ListenersWeakMap=new WeakMap;var createListener=node=>{const listener=Object.create(EventListener);ListenersWeakMap.set(node,listener);return listener};function eventExpression(node,_ref6,value){let{name}=_ref6;const normalizedEventName=name.replace(RE_EVENTS_PREFIX,"");const eventListener=ListenersWeakMap.get(node)||createListener(node);const[callback,options]=getCallbackAndOptions(value);const handler=eventListener[normalizedEventName];const mustRemoveEvent=handler&&!callback;const mustAddEvent=callback&&!handler;if(mustRemoveEvent){node.removeEventListener(normalizedEventName,eventListener)}if(mustAddEvent){node.addEventListener(normalizedEventName,eventListener,options)}eventListener[normalizedEventName]=callback}function normalizeStringValue(value){return isNil(value)?"":value}var getTextNode=(node,childNodeIndex)=>{const target=node.childNodes[childNodeIndex];if(target.nodeType===Node.COMMENT_NODE){const textNode=document.createTextNode("");node.replaceChild(textNode,target);return textNode}return target};function textExpression(node,data,value){node.data=normalizeStringValue(value)}function valueExpression(node,expression,value){node.value=normalizeStringValue(value)}var expressions={[ATTRIBUTE]:attributeExpression,[EVENT]:eventExpression,[TEXT]:textExpression,[VALUE]:valueExpression};var Expression={mount(scope){this.value=this.evaluate(scope);apply(this,this.value);return this},update(scope){const value=this.evaluate(scope);if(this.value!==value){apply(this,value);this.value=value}return this},unmount(){if(this.type===EVENT)apply(this,null);return this}};function apply(expression,value){return expressions[expression.type](expression.node,expression,value,expression.value)}function create$4(node,data){return Object.assign({},Expression,data,{node:data.type===TEXT?getTextNode(node,data.childNodeIndex):node})}function flattenCollectionMethods(collection,methods,context){return methods.reduce((acc,method)=>{return Object.assign({},acc,{[method]:scope=>{return collection.map(item=>item[method](scope))&&context}})},{})}function create$3(node,_ref7){let{expressions:expressions2}=_ref7;return Object.assign({},flattenCollectionMethods(expressions2.map(expression=>create$4(node,expression)),["mount","update","unmount"]))}function extendParentScope(attributes,scope,parentScope){if(!attributes||!attributes.length)return parentScope;const expressions2=attributes.map(attr=>Object.assign({},attr,{value:attr.evaluate(scope)}));return Object.assign(Object.create(parentScope||null),evaluateAttributeExpressions(expressions2))}var getRealParent=(scope,parentScope)=>scope[PARENT_KEY_SYMBOL]||parentScope;var SlotBinding={attributes:[],getTemplateScope(scope,parentScope){return extendParentScope(this.attributes,scope,parentScope)},mount(scope,parentScope){const templateData=scope.slots?scope.slots.find(_ref8=>{let{id}=_ref8;return id===this.name}):false;const{parentNode}=this.node;const realParent=getRealParent(scope,parentScope);this.template=templateData&&create(templateData.html,templateData.bindings).createDOM(parentNode);if(this.template){cleanNode(this.node);this.template.mount(this.node,this.getTemplateScope(scope,realParent),realParent);this.template.children=Array.from(this.node.childNodes)}moveSlotInnerContent(this.node);removeChild(this.node);return this},update(scope,parentScope){if(this.template){const realParent=getRealParent(scope,parentScope);this.template.update(this.getTemplateScope(scope,realParent),realParent)}return this},unmount(scope,parentScope,mustRemoveRoot){if(this.template){this.template.unmount(this.getTemplateScope(scope,parentScope),null,mustRemoveRoot)}return this}};function moveSlotInnerContent(slot){const child=slot&&slot.firstChild;if(!child)return;insertBefore(child,slot);moveSlotInnerContent(slot)}function createSlot(node,_ref9){let{name,attributes}=_ref9;return Object.assign({},SlotBinding,{attributes,node,name})}function getTag(component2,slots,attributes){if(slots===void 0){slots=[]}if(attributes===void 0){attributes=[]}if(component2){return component2({slots,attributes})}return create(slotsToMarkup(slots),[...slotBindings(slots),{expressions:attributes.map(attr=>{return Object.assign({type:ATTRIBUTE},attr)})}])}function slotBindings(slots){return slots.reduce((acc,_ref10)=>{let{bindings:bindings2}=_ref10;return acc.concat(bindings2)},[])}function slotsToMarkup(slots){return slots.reduce((acc,slot)=>{return acc+slot.html},"")}var TagBinding={mount(scope){return this.update(scope)},update(scope,parentScope){const name=this.evaluate(scope);if(name&&name===this.name){this.tag.update(scope)}else{this.unmount(scope,parentScope,true);this.name=name;this.tag=getTag(this.getComponent(name),this.slots,this.attributes);this.tag.mount(this.node,scope)}return this},unmount(scope,parentScope,keepRootTag){if(this.tag){this.tag.unmount(keepRootTag)}return this}};function create$2(node,_ref11){let{evaluate,getComponent,slots,attributes}=_ref11;return Object.assign({},TagBinding,{node,evaluate,slots,attributes,getComponent})}var bindings={[IF]:create$5,[SIMPLE]:create$3,[EACH]:create$6,[TAG]:create$2,[SLOT]:createSlot};function fixTextExpressionsOffset(expressions2,textExpressionsOffset){return expressions2.map(e=>e.type===TEXT?Object.assign({},e,{childNodeIndex:e.childNodeIndex+textExpressionsOffset}):e)}function create$1(root,binding,templateTagOffset){const{selector,type,redundantAttribute,expressions:expressions2}=binding;const node=selector?root.querySelector(selector):root;if(redundantAttribute)node.removeAttribute(redundantAttribute);const bindingExpressions=expressions2||[];return(bindings[type]||bindings[SIMPLE])(node,Object.assign({},binding,{expressions:templateTagOffset&&!selector?fixTextExpressionsOffset(bindingExpressions,templateTagOffset):bindingExpressions}))}function createHTMLTree(html,root){const template=isTemplate(root)?root:document.createElement("template");template.innerHTML=html;return template.content}function createSVGTree(html,container){const svgNode=container.ownerDocument.importNode(new window.DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg">${html}</svg>`,"application/xml").documentElement,true);return svgNode}function createDOMTree(root,html){if(isSvg(root))return createSVGTree(html,root);return createHTMLTree(html,root)}function injectDOM(el,dom){switch(true){case isSvg(el):moveChildren(dom,el);break;case isTemplate(el):el.parentNode.replaceChild(dom,el);break;default:el.appendChild(dom)}}function createTemplateDOM(el,html){return html&&(typeof html==="string"?createDOMTree(el,html):html)}function getTemplateTagOffset(parentNode,el,meta){const siblings=Array.from(parentNode.childNodes);return Math.max(siblings.indexOf(el),siblings.indexOf(meta.head)+1,0)}var TemplateChunk={createDOM(el){this.dom=this.dom||createTemplateDOM(el,this.html)||document.createDocumentFragment();return this},mount(el,scope,parentScope,meta){if(meta===void 0){meta={}}if(!el)panic("Please provide DOM node to mount properly your template");if(this.el)this.unmount(scope);const{fragment,children,avoidDOMInjection}=meta;const{parentNode}=children?children[0]:el;const isTemplateTag=isTemplate(el);const templateTagOffset=isTemplateTag?getTemplateTagOffset(parentNode,el,meta):null;this.createDOM(el);const cloneNode=fragment||this.dom.cloneNode(true);this.el=isTemplateTag?parentNode:el;this.children=isTemplateTag?children||Array.from(cloneNode.childNodes):null;if(!avoidDOMInjection&&cloneNode)injectDOM(el,cloneNode);this.bindings=this.bindingsData.map(binding=>create$1(this.el,binding,templateTagOffset));this.bindings.forEach(b2=>b2.mount(scope,parentScope));this.meta=meta;return this},update(scope,parentScope){this.bindings.forEach(b2=>b2.update(scope,parentScope));return this},unmount(scope,parentScope,mustRemoveRoot){if(mustRemoveRoot===void 0){mustRemoveRoot=false}const el=this.el;if(!el){return this}this.bindings.forEach(b2=>b2.unmount(scope,parentScope,mustRemoveRoot));switch(true){case(el[IS_PURE_SYMBOL]||mustRemoveRoot===null):break;case Array.isArray(this.children):clearChildren(this.children);break;case!mustRemoveRoot:cleanNode(el);break;case!!mustRemoveRoot:removeChild(el);break}this.el=null;return this},clone(){return Object.assign({},this,{meta:{},el:null})}};function create(html,bindings2){if(bindings2===void 0){bindings2=[]}return Object.assign({},TemplateChunk,{html,bindingsData:bindings2})}function componentTemplateFactory(template,componentWrapper,getChildComponent){return template(create,expressionTypes,bindingTypes,getChildComponent)}var bindDOMNodeToComponentInstance=(node,component2)=>node[DOM_COMPONENT_INSTANCE_PROPERTY]=component2;function createCoreAPIMethods(mapFunction){return[MOUNT_METHOD_KEY,UPDATE_METHOD_KEY,UNMOUNT_METHOD_KEY].reduce((acc,method)=>{acc[method]=mapFunction(method);return acc},{})}function createPureComponent(pureFactoryFunction,_ref){let{slots,attributes,props,css,template}=_ref;if(template)panic("Pure components can not have html");if(css)panic("Pure components do not have css");const component2=defineDefaults(pureFactoryFunction({slots,attributes,props}),PURE_COMPONENT_API);return createCoreAPIMethods(method=>function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}if(method===MOUNT_METHOD_KEY){const[element]=args;defineProperty(element,IS_PURE_SYMBOL,true);bindDOMNodeToComponentInstance(element,component2)}component2[method](...args);return component2})}function domToArray(els){if(!Array.isArray(els)){if(/^\[object (HTMLCollection|NodeList|Object)\]$/.test(Object.prototype.toString.call(els))&&typeof els.length==="number")return Array.from(els);else return[els]}return els}function $(selector,scope){return domToArray(typeof selector==="string"?(scope||document).querySelectorAll(selector):selector)}var COMPONENT_DOM_SELECTORS=Object.freeze({$(selector){return $(selector,this.root)[0]},$$(selector){return $(selector,this.root)}});var COMPONENT_LIFECYCLE_METHODS=Object.freeze({[SHOULD_UPDATE_KEY]:noop,[ON_BEFORE_MOUNT_KEY]:noop,[ON_MOUNTED_KEY]:noop,[ON_BEFORE_UPDATE_KEY]:noop,[ON_UPDATED_KEY]:noop,[ON_BEFORE_UNMOUNT_KEY]:noop,[ON_UNMOUNTED_KEY]:noop});var normalize=values=>values.length===1?values[0]:values;function parseNodes(els,name,method){const names=typeof name==="string"?[name]:name;return normalize(domToArray(els).map(el=>{return normalize(names.map(n=>el[method](n)))}))}function set(els,name,value){const attrs=typeof name==="object"?name:{[name]:value};const props=Object.keys(attrs);domToArray(els).forEach(el=>{props.forEach(prop=>el.setAttribute(prop,attrs[prop]))});return els}function get(els,name){return parseNodes(els,name,"getAttribute")}var CSS_BY_NAME=new Map;var STYLE_NODE_SELECTOR="style[riot]";var getStyleNode=(style=>{return()=>{if(style)return style;style=$(STYLE_NODE_SELECTOR)[0]||document.createElement("style");set(style,"type","text/css");if(!style.parentNode)document.head.appendChild(style);return style}})();var cssManager={CSS_BY_NAME,add(name,css){if(!CSS_BY_NAME.has(name)){CSS_BY_NAME.set(name,css);this.inject()}return this},inject(){getStyleNode().innerHTML=[...CSS_BY_NAME.values()].join("\n");return this},remove(name){if(CSS_BY_NAME.has(name)){CSS_BY_NAME.delete(name);this.inject()}return this}};function curry(fn){for(var _len=arguments.length,acc=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){acc[_key-1]=arguments[_key]}return function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}args=[...acc,...args];return args.length<fn.length?curry(fn,...args):fn(...args)}}function getName(element){return get(element,IS_DIRECTIVE)||element.tagName.toLowerCase()}function addCssHook(element,name){if(getName(element)!==name){set(element,IS_DIRECTIVE,name)}}function computeComponentState(oldState,newState){return Object.assign({},oldState,callOrAssign(newState))}function computeInitialProps(element,initialProps){if(initialProps===void 0){initialProps={}}return Object.assign({},DOMattributesToObject(element),callOrAssign(initialProps))}function createAttributeBindings(node,attributes){if(attributes===void 0){attributes=[]}const expressions2=attributes.map(a2=>create$4(node,a2));const binding={};return Object.assign(binding,Object.assign({expressions:expressions2},createCoreAPIMethods(method=>scope=>{expressions2.forEach(e=>e[method](scope));return binding})))}function runPlugins(component2){return[...PLUGINS_SET].reduce((c,fn)=>fn(c)||c,component2)}function manageComponentLifecycle(component2,_ref){let{slots,attributes,props}=_ref;return autobindMethods(runPlugins(defineProperties(isObject(component2)?Object.create(component2):component2,{mount(element,state,parentScope){if(state===void 0){state={}}defineProperty(element,IS_PURE_SYMBOL,false);this[PARENT_KEY_SYMBOL]=parentScope;this[ATTRIBUTES_KEY_SYMBOL]=createAttributeBindings(element,attributes).mount(parentScope);defineProperty(this,PROPS_KEY,Object.freeze(Object.assign({},computeInitialProps(element,props),evaluateAttributeExpressions(this[ATTRIBUTES_KEY_SYMBOL].expressions))));this[STATE_KEY]=computeComponentState(this[STATE_KEY],state);this[TEMPLATE_KEY_SYMBOL]=this.template.createDOM(element).clone();bindDOMNodeToComponentInstance(element,this);component2.name&&addCssHook(element,component2.name);defineProperty(this,ROOT_KEY,element);defineProperty(this,SLOTS_KEY,slots);this[ON_BEFORE_MOUNT_KEY](this[PROPS_KEY],this[STATE_KEY]);this[TEMPLATE_KEY_SYMBOL].mount(element,this,parentScope);this[ON_MOUNTED_KEY](this[PROPS_KEY],this[STATE_KEY]);return this},update(state,parentScope){if(state===void 0){state={}}if(parentScope){this[PARENT_KEY_SYMBOL]=parentScope;this[ATTRIBUTES_KEY_SYMBOL].update(parentScope)}const newProps=evaluateAttributeExpressions(this[ATTRIBUTES_KEY_SYMBOL].expressions);if(this[SHOULD_UPDATE_KEY](newProps,this[PROPS_KEY])===false)return;defineProperty(this,PROPS_KEY,Object.freeze(Object.assign({},this[PROPS_KEY],newProps)));this[STATE_KEY]=computeComponentState(this[STATE_KEY],state);this[ON_BEFORE_UPDATE_KEY](this[PROPS_KEY],this[STATE_KEY]);if(!this[IS_COMPONENT_UPDATING]){this[IS_COMPONENT_UPDATING]=true;this[TEMPLATE_KEY_SYMBOL].update(this,this[PARENT_KEY_SYMBOL])}this[ON_UPDATED_KEY](this[PROPS_KEY],this[STATE_KEY]);this[IS_COMPONENT_UPDATING]=false;return this},unmount(preserveRoot){this[ON_BEFORE_UNMOUNT_KEY](this[PROPS_KEY],this[STATE_KEY]);this[ATTRIBUTES_KEY_SYMBOL].unmount();this[TEMPLATE_KEY_SYMBOL].unmount(this,this[PARENT_KEY_SYMBOL],preserveRoot===null?null:!preserveRoot);this[ON_UNMOUNTED_KEY](this[PROPS_KEY],this[STATE_KEY]);return this}})),Object.keys(component2).filter(prop=>isFunction(component2[prop])))}function instantiateComponent(_ref){let{css,template,componentAPI,name}=_ref;if(css&&name)cssManager.add(name,css);return curry(manageComponentLifecycle)(defineProperties(defineDefaults(componentAPI,Object.assign({},COMPONENT_LIFECYCLE_METHODS,{[PROPS_KEY]:{},[STATE_KEY]:{}})),Object.assign({[SLOTS_KEY]:null,[ROOT_KEY]:null},COMPONENT_DOM_SELECTORS,{name,css,template})))}function createChildrenComponentsObject(components){if(components===void 0){components={}}return Object.entries(callOrAssign(components)).reduce((acc,_ref)=>{let[key,value]=_ref;acc[camelToDashCase(key)]=createComponentFromWrapper(value);return acc},{})}var createChildComponentGetter=componentWrapper=>{const childrenComponents=createChildrenComponentsObject(componentWrapper.exports?componentWrapper.exports.components:{});return name=>{if(name===componentWrapper.name)return memoizedCreateComponentFromWrapper(componentWrapper);return childrenComponents[name]||COMPONENTS_IMPLEMENTATION_MAP.get(name)}};var memoizedCreateComponentFromWrapper=memoize(createComponentFromWrapper);function createComponentFromWrapper(componentWrapper){const{css,template,exports,name}=componentWrapper;const templateFn=template?componentTemplateFactory(template,componentWrapper,createChildComponentGetter(componentWrapper)):MOCKED_TEMPLATE_INTERFACE;return _ref2=>{let{slots,attributes,props}=_ref2;if(exports&&exports[IS_PURE_SYMBOL])return createPureComponent(exports,{slots,attributes,props,css,template});const componentAPI=callOrAssign(exports)||{};const component2=instantiateComponent({css,template:templateFn,componentAPI,name})({slots,attributes,props});return{mount(element,parentScope,state){return component2.mount(element,state,parentScope)},update(parentScope,state){return component2.update(state,parentScope)},unmount(preserveRoot){return component2.unmount(preserveRoot)}}}}function register(name,_ref){let{css,template,exports}=_ref;if(COMPONENTS_IMPLEMENTATION_MAP.has(name))panic(`The component "${name}" was already registered`);COMPONENTS_IMPLEMENTATION_MAP.set(name,createComponentFromWrapper({name,css,template,exports}));return COMPONENTS_IMPLEMENTATION_MAP}function unregister(name){if(!COMPONENTS_IMPLEMENTATION_MAP.has(name))panic(`The component "${name}" was never registered`);COMPONENTS_IMPLEMENTATION_MAP.delete(name);cssManager.remove(name);return COMPONENTS_IMPLEMENTATION_MAP}function mountComponent(element,initialProps,componentName,slots){const name=componentName||getName(element);if(!COMPONENTS_IMPLEMENTATION_MAP.has(name))panic(`The component named "${name}" was never registered`);const component2=COMPONENTS_IMPLEMENTATION_MAP.get(name)({props:initialProps,slots});return component2.mount(element)}function mount(selector,initialProps,name){return $(selector).map(element=>mountComponent(element,initialProps,name))}function unmount(selector,keepRootElement){return $(selector).map(element=>{if(element[DOM_COMPONENT_INSTANCE_PROPERTY]){element[DOM_COMPONENT_INSTANCE_PROPERTY].unmount(keepRootElement)}return element})}function install(plugin){if(!isFunction(plugin))panic("Plugins must be of type function");if(PLUGINS_SET.has(plugin))panic("This plugin was already installed");PLUGINS_SET.add(plugin);return PLUGINS_SET}function uninstall(plugin){if(!PLUGINS_SET.has(plugin))panic("This plugin was never installed");PLUGINS_SET.delete(plugin);return PLUGINS_SET}function compose(){for(var _len2=arguments.length,fns=new Array(_len2),_key2=0;_key2<_len2;_key2++){fns[_key2]=arguments[_key2]}return fns.reduce((f,g)=>function(){return f(g(...arguments))})}function component(implementation){return function(el,props,_temp){let{slots,attributes,parentScope}=_temp===void 0?{}:_temp;return compose(c=>c.mount(el,parentScope),c=>c({props,slots,attributes}),createComponentFromWrapper)(implementation)}}function pure(func){if(!isFunction(func))panic('riot.pure accepts only arguments of type "function"');func[IS_PURE_SYMBOL]=true;return func}var withTypes=component2=>component2;var version="v7.1.0";var __={cssManager,DOMBindings:{template:create,createBinding:create$1,createExpression:create$4,bindingTypes,expressionTypes},globals:{DOM_COMPONENT_INSTANCE_PROPERTY,PARENT_KEY_SYMBOL}};var util_exports={};__export(util_exports,{destruct:()=>destruct,finalizer:()=>finalizer,glBuffer:()=>glBuffer,glFrameBuffer:()=>glFrameBuffer,glProgram:()=>glProgram,glTextureRenderer:()=>glTextureRenderer,implementEventTarget:()=>implementEventTarget,importOptions:()=>importOptions,int2hex:()=>int2hex,loadWasm:()=>loadWasm,sleep:()=>sleep});function importOptions(obj,options,default_values){Object.keys(default_values).forEach(k=>{if(options.hasOwnProperty(k)){obj[k]=isNaN(options[k])?options[k]:Number(options[k])}else{obj[k]=default_values[k]}});return obj}async function sleep(ms){return new Promise(resolve=>setTimeout(resolve,ms))}var finalizer=new FinalizationRegistry(destructor=>{if(Array.isArray(destructor[0])){for(let d of destructor){if(Array.isArray(d[1])){d[0](...d[1])}else{d[0](d[1])}}}else{if(Array.isArray(destructor[1])){destructor[0](...destructor[1])}else{destructor[0](destructor[1])}}});async function loadWasm(wasmFile){let obj=await WebAssembly.instantiateStreaming(fetch(wasmFile),{});let wasm2=Object.assign({},obj.instance.exports);let heap={};heap.u32=new Uint32Array(wasm2.memory.buffer);heap.i32=new Int32Array(wasm2.memory.buffer);heap.u16=new Uint16Array(wasm2.memory.buffer);heap.i16=new Int16Array(wasm2.memory.buffer);heap.u8c=new Uint8ClampedArray(wasm2.memory.buffer);heap.u8=new Uint8Array(wasm2.memory.buffer);heap.i8=new Int8Array(wasm2.memory.buffer);heap.i64=new BigInt64Array(wasm2.memory.buffer);heap.u64=new BigUint64Array(wasm2.memory.buffer);heap.f32=new Float32Array(wasm2.memory.buffer);heap.f64=new Float64Array(wasm2.memory.buffer);for(let key of Object.keys(heap)){heap[key].alloc=n=>{const _Class=heap[key].constructor;let ptr;try{ptr=wasm2.malloc(_Class.BYTES_PER_ELEMENT*n)}catch{ptr=null}if(!ptr){alert("out of memory");throw new Error("out of memory")}const mem=new _Class(wasm2.memory.buffer,ptr,n);mem.ptr=mem.byteOffset;finalizer.register(mem,[wasm2.free,[mem.ptr]],mem);mem.free=()=>{finalizer.unregister(mem);wasm2.free(mem.ptr)};return mem}}return Object.assign(wasm2,heap)}function destruct(...objs){for(const obj of objs)if(obj&&obj.destructor)obj.destructor()}function implementEventTarget(obj){const eventTarget=new EventTarget;obj.addEventListener=(...args)=>eventTarget.addEventListener(...args);obj.removeEventListener=(...args)=>eventTarget.removeEventListener(...args);obj.dispatchEvent=(event,detail_content)=>eventTarget.dispatchEvent(new CustomEvent(event,{detail:detail_content}))}function int2hex(i){return("000"+((i|0)>>>16&65535).toString(16)).slice(-4)+("000"+((i|0)&65535).toString(16)).slice(-4)}var glAttribute=class{constructor(gl,loc){this.gl=gl;this.loc=loc}set ptr(arg2){const[vbuffer,size,type,normalized,stride,offset]=arg2;vbuffer.bind(()=>{this.gl.vertexAttribPointer(this.loc,size,type,normalized,stride,offset);this.gl.enableVertexAttribArray(this.loc)})}set f(arg2){if(!Array.isArray(arg2))arg2=[arg2];switch(arg2.length){case 1:this.gl.vertexAttrib1fv(this.loc,arg2);break;case 2:this.gl.vertexAttrib2fv(this.loc,arg2);break;case 3:this.gl.vertexAttrib3fv(this.loc,arg2);break;case 4:this.gl.vertexAttrib4fv(this.loc,arg2);break;default:throw new Error(`${arg2.length} parameters are given expecting 1 - 4`)}}};var glUniform=class{constructor(gl,loc){this.gl=gl;this.loc=loc}set f(arg2){if(!Array.isArray(arg2))arg2=[arg2];switch(arg2.length){case 1:this.gl.uniform1fv(this.loc,arg2);break;case 2:this.gl.uniform2fv(this.loc,arg2);break;case 3:this.gl.uniform3fv(this.loc,arg2);break;case 4:this.gl.uniform4fv(this.loc,arg2);break;default:throw new Error(`${arg2.length} parameters are given expecting 1 - 4`)}}set i(arg2){if(!Array.isArray(arg2))arg2=[arg2];switch(arg2.length){case 1:this.gl.uniform1iv(this.loc,arg2);break;case 2:this.gl.uniform2iv(this.loc,arg2);break;case 3:this.gl.uniform3iv(this.loc,arg2);break;case 4:this.gl.uniform4iv(this.loc,arg2);break;default:throw new Error(`${arg2.length} parameters are given expecting 1 - 4`)}}#matCore(transpose,values){switch(values.length){case 4:this.gl.uniformMatrix2fv(this.loc,transpose,values);break;case 9:this.gl.uniformMatrix3fv(this.loc,transpose,values);break;case 16:this.gl.uniformMatrix4fv(this.loc,transpose,values);break;default:throw new Error(`${arg.length} parameters are given expecting 4 or 9 or 16`)}}set mat(values){this.#matCore(false,values)}set matTrans(values){this.#matCore(true,values)}};var glProgram=class{constructor(gl,vsrc,fsrc,attrs=[],unifs=[]){this.gl=gl;this.program=gl.createProgram();this.#glCreateShader(gl,vsrc,gl.VERTEX_SHADER,this.program);this.#glCreateShader(gl,fsrc,gl.FRAGMENT_SHADER,this.program);gl.linkProgram(this.program);if(!gl.getProgramParameter(this.program,gl.LINK_STATUS))throw new Error(gl.getProgramInfoLog(this.program));attrs.forEach(attr=>{const loc=gl.getAttribLocation(this.program,attr);this[attr]=new glAttribute(gl,loc)});unifs.forEach(unif=>{const loc=gl.getUniformLocation(this.program,unif);this[unif]=new glUniform(gl,loc)})}destructor(){this.gl.deleteProgram(this.program)}#glCreateShader(gl,src,type,program=null){var shader=gl.createShader(type);gl.shaderSource(shader,src);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS))throw new Error(gl.getShaderInfoLog(shader));if(!program)return shader;gl.attachShader(program,shader);gl.deleteShader(shader);return null}use(){this.gl.useProgram(this.program)}};var glBuffer=class{constructor(gl,type){this.gl=gl;this.type=type;this.buffer=gl.createBuffer();util.finalizer.register(this,[gl.deleteBuffer,this.buffer],this)}destructor(){util.finalizer.unregister(this);this.gl.deleteBuffer(this.buffer)}bind(func){if(func&&typeof func==="function"){this.bind();try{func()}finally{this.unbind()}}else{this.gl.bindBuffer(this.type,this.buffer)}}unbind(){this.gl.bindBuffer(this.type,null)}data(float32Array,mode){this.bind(()=>{this.gl.bufferData(this.type,float32Array,mode)});this.dataLength=float32Array.length}subData(offset,float32Array=null){this.bind(()=>{if(float32Array){this.gl.bufferSubData(this.type,offset,float32Array)}else{this.gl.bufferSubData(this.type,offset)}})}};var glFrameBuffer=class{constructor(gl,width,height,depth=true){this.gl=gl;this.width=width;this.height=height;this.frameBuffer=gl.createFramebuffer();this.bind(()=>{if(depth){this.depthBuffer=gl.createRenderbuffer();this.resizeDepthBuffer();gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,this.depthBuffer)}this.texture=gl.createTexture();this.#resizeTeture();gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texture,0)});if(this.depthBuffer){util.finalizer.register(this,[[gl.deleteFramebuffer,this.frameBuffer],[gl.deleteRenderbuffer,this.depthBuffer],[gl.deleteTexture,this.texture]],this)}else{util.finalizer.register(this,[[gl.deleteFramebuffer,this.frameBuffer],[gl.deleteTexture,this.texture]],this)}}destructor(){util.finalizer.unregister(this);if(this.depthBuffer)this.gl.deleteRenderBuffer(this.depthBuffer);if(this.teture)this.gl.deleteTexture(this.texture);this.gl.deleteFramebuffer(this.frameBuffer)}resize(width,height){if(this.width==width&&this.height==height)return;this.width=width;this.height=height;this.#resizeDepthBuffer();this.#resizeTeture()}#resizeDepthBuffer(){const{gl,depthBuffer,width,height}=this;if(depthBuffer){gl.bindRenderbuffer(gl.RENDERBUFFER,depthBuffer);try{gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,width,height)}finally{gl.bindRenderbuffer(gl.RENDERBUFFER,null)}}}#resizeTeture(){const{gl,texture,width,height}=this;gl.bindTexture(gl.TEXTURE_2D,texture);try{gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width,height,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)}finally{gl.bindTexture(gl.TEXTURE_2D,null)}}bind(func){if(func&&typeof func==="function"){this.bind();try{func()}finally{this.unbind()}}else{const{gl,frameBuffer}=this;gl.bindFramebuffer(gl.FRAMEBUFFER,frameBuffer)}}unbind(){const{gl,frameBuffer}=this;gl.bindFramebuffer(gl.FRAMEBUFFER,null)}};var glTextureRenderer=class{constructor(gl,fsrc,u_list=[]){this.gl=gl;const vsrc=`
      attribute vec3 a_pos;
      void main() {
        gl_Position = vec4( a_pos, 1.0 );
      }
    `;this.program=new glProgram(gl,vsrc,fsrc,["a_pos"],["u_texture",...u_list]);this.vbuffer=new glBuffer(gl,gl.ARRAY_BUFFER);this.vbuffer.data(new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),gl.STATIC_DRAW)}destructor(){util.destruct(this.program);util.destruct(this.vbuffer)}render(n_texture,texture,preparation,destBuffer=null){if(destBuffer){destBuffer.bind(()=>this.#renderCore(n_texture,texture,preparation))}else{this.#renderCore(n_texture,texture,preparation)}}#renderCore(n_texture,texture,preparation){const{gl,program,vbuffer}=this;program.use();program.u_texture.i=n_texture;gl.activeTexture(gl[`TEXTURE${n_texture}`]);gl.bindTexture(gl.TEXTURE_2D,texture);preparation(gl,program);program.a_pos.ptr=[vbuffer,2,gl.FLOAT,false,0,0];gl.drawArrays(gl.TRIANGLES,0,6);gl.flush()}};var recommendations_default=[["\uFF12\u8272","?2_50_0_0n_10_1.5_0.5_0xxxx8"],["\uFF13\u8272","?3_80_0_0n_10_2_0.2_0xxxx5"],["10\u8272","?10_100_0_0n_0_4_0.5_0xxxx5"],["12\u8272","?12_40_0_0n_0_1.5_0.2_3xxxx8","recommend"],["20\u8272","?20_40_0_0n_0_1.5_0.1_4xxxx6"],["30\u8272","?30_50_0A_0n_0_2_0.25_0xxxx5"],["60\u8272","?60_70_0A_0n_0_3_0.1_0xxxx5"]];var PLSpeciesDistribution2=class{constructor(nspecies,particles_or_rand){this.distribution=Array(nspecies);if(particles_or_rand.constructor.name=="PLParticles"){let particles=particles_or_rand;for(let i=0;i<particles.n;i++){let sp=particles.get(i)[0];this.distribution[sp]=1+(this.distribution[sp]||0)}}else{let rand=particles_or_rand;for(let i=0;i<nspecies;i++){for(let j=0;j<5;j++){this.distribution[i]=rand.next()+(this.distribution[i]||0)}}}this.update()}ratio(sp){return this.distribution[sp]/this.sum}update(){this.sum=0;this.accumulation=this.distribution.map(d=>this.sum+=d).map(d=>d/this.sum)}species(r){return this.accumulation.findIndex(elem=>r<=elem)}};var I18n=class{constructor(){implementEventTarget(this);this.setLocale();this.missingMessageShown={}}translate(src){return this.t(src)}t(src,id){const key=id?`id_${id}`:src;for(let loc of this.locales){if(loc==this.originalLocale)return src;if(this.dictionary[loc]&&this.dictionary[loc][key])return this.dictionary[loc][key]}for(let loc of this.locales){loc=loc.split("-")[0];if(loc==this.originalLocale)return src;if(this.dictionary[loc]&&this.dictionary[loc][key])return this.dictionary[loc][key]}this.#showTranslationMissingMessageFor(key,src);return src}#showTranslationMissingMessageFor(key,src){if(this.missingMessageShown[key])return;if(Object.keys(this.missingMessageShown).length==0){console.log(`i18n: translation(s) are missing for locale "${this.locales.join(", ")}":`)}this.missingMessageShown[key]=true;if(key!=src){src.split(/\n/).forEach(line=>console.log(`    // ${line}`))}console.log(`    '${key}':`);console.log("    '',")}tag(template,...args){let str=template[0];for(let i=1;i<template.length;i++){str+=`_arg${i}_`;str+=template[i]}str=this.t(str);for(let i=1;i<template.length;i++){str=str.replace(`_arg${i}_`,args[i-1])}return str}browserLocales(){return navigator.languages||[navigator.language||navigator.userLanguage||navigator.browserLanguage]}setDictionary(originalLocale,dict){this.originalLocale=originalLocale;this.dictionary=dict;this.dispatchEvent("update",{});this.missingMessageShown={}}setLocale(loc=this.browserLocales()){if(Array.isArray(loc)){this.locales=loc}else{this.locales=[loc]}this.dispatchEvent("update",{});this.missingMessageShown={}}};var i18n2=new I18n;var i18n_dictionary_default={"en":{"\u7C92\u5B50\u306B\u547D\u304C\u5BBF\u308B\u4E16\u754C\u3092\u306E\u3093\u3073\u308A\u773A\u3081\u308B\u30B5\u30A4\u30C8\u3067\u3059\u3002":"Enjoy watching the worlds where the particles come to life. ","\u98FD\u304D\u305F\u3089\u300C\u6B21\u306E\u30EF\u30FC\u30EB\u30C9\u3092\u751F\u6210\u300D\u3092\u62BC\u3057\u3066\u4E0B\u3055\u3044\u3002":'When bored, press "Next World". ',"\u6B21\u306E\u30EF\u30FC\u30EB\u30C9\u3092\u751F\u6210":"Next World","\u3053\u306E\u30EF\u30FC\u30EB\u30C9\u3092\u30B7\u30A7\u30A2":"Share this world","\u3053\u306E\u30EF\u30FC\u30EB\u30C9\u3078\u306E URL \u3092\u30B3\u30D4\u30FC\u3057\u307E\u3057\u305F":"URL to this world was copied to clipboard","\u5168\u753B\u9762":"Full Screen","\u753B\u9762\u5916\u306E\u30C0\u30D6\u30EB\u30BF\u30C3\u30D7\u3067\u6B21\u306E\u30EF\u30FC\u30EB\u30C9\u3092\u751F\u6210\u3067\u304D\u307E\u3059":"Double-tap on the periphery to move to the next world.","\u30EF\u30FC\u30EB\u30C9\u8A2D\u5B9A":"World config.","URL\u3067":"by URL","\u63CF\u753B\u5236\u5FA1":"Rendering control","\u59CB\u3081\u306B\u623B\u3063\u3066\u30EA\u30D7\u30EC\u30A4":"Replay from the begining","\u30DD\u30FC\u30BA\uFF0F\u518D\u958B":"Pause/Unpause","webm \u306B\u9332\u753B":"Record as webm","\u30AB\u30E9\u30FC\u30D1\u30EC\u30C3\u30C8\u7DE8\u96C6":"Edit color palette","\u7C92\u5F84":"Particle dia.","\u753B\u9762":"Screen","\u6700\u5927fps":"Max fps","\u4F7F\u3044\u65B9":"Usage","\u7C92\u5B50\u7A2E\u6570":"N Species","\u221A\u7C92\u5B50\u6570":"\u221AN Particles","\u30B9\u30B1\u30FC\u30EB":"Scale","\u8A08\u7B97\u30B9\u30C6\u30C3\u30D7":"Calc. step","\u5C3E\u306E\u9577\u3055":"Tail length","\u63FA\u52D5":"Perturbation","\u76F8\u4E92\u4F5C\u7528\u30BB\u30C3\u30C8":"Interaction set","\u30C7\u30D5\u30A9\u30EB\u30C8":"Default","\u591A\u7C92\u5B50\u7A2E\u88DC\u6B63A":"Many species adapt. A","\u591A\u7C92\u5B50\u7A2E\u88DC\u6B63B":"Many species adapt. B","\u76F8\u4E92\u4F5C\u7528\u30B7\u30FC\u30C9":"Interaction seed","\u7C92\u5B50\u914D\u7F6E\u30B7\u30FC\u30C9":"Arrangement seed","\u30D1\u30E9\u30E1\u30FC\u30BF\u30A8\u30C7\u30A3\u30BF\u3092\u8868\u793A/\u975E\u8868\u793A":"Show/Hide parameter editor","\u81EA\u5206\u3067":"by yourself","\uFF12\u8272":"2-color","\uFF13\u8272":"3-color","10\u8272":"10-color","12\u8272":"12-color","20\u8272":"20-color","30\u8272":"30-color","60\u8272":"60-color","\u76F8\u4E92\u4F5C\u7528\u4FC2\u6570\u30DE\u30C8\u30EA\u30AF\u30B9":"Interaction coefficient matrix","\u76F8\u4E92\u4F5C\u7528\u8DDD\u96E2\u30FB\u6E1B\u8870\u30FB\u63FA\u52D5":"Interaction distances, decelation and perturbation","\u76F8\u4E92\u4F5C\u7528\u306F\u975E\u5BFE\u79F0\u3067 a \u304C b \u304B\u3089\u53D7\u3051\u308B\u529B\u3068 b \u304C a \u304B\u3089\u53D7\u3051\u308B\u529B\u306F\u7570\u306A\u308B":"The interaction is asymmetric. The force from A to B is independent of the force from B to A.","\u5F15\u529B\u306F\u8CA0\u3067\u9752\u3001\u65A5\u529B\u306F\u6B63\u3067\u8D64":"Attractive force is represented by negative values and blue, repulsive force is represented by positive values and red.","\u8FD1\u8DDD\u96E2\u529B\uFF08\u7C92\u5B50\u304C\u6975\u7AEF\u306B\u8FD1\u3065\u3044\u305F\u6642\u306E\u529B\uFF09\u306F\u5E38\u306B\u65A5\u529B":"The short-range force is always repulsive (positive).","\u9060\u8DDD\u96E2\u529B\u306F\u5F15\u529B\u306B\u3082\u65A5\u529B\u306B\u3082\u306A\u308B":"The long-range force can be either positive or negative.","\u5B9F\u969B\u306B\u639B\u304B\u308B\u529B\u306F\u3053\u3053\u3067\u6307\u5B9A\u3057\u305F\u4FC2\u6570\u3092\u8DDD\u96E2\u306B\u5FDC\u3058\u3066\u6E1B\u8870\u3055\u305B\u305F\u5024\u306B\u306A\u308B":"The actual force is calculated by attenuating the given value using the distance.","id_\u8FD1\u8DDD\u96E2\u65A5\u529B\u8AAC\u660E":"The repulsive force at close range has its maximum value at r = 0 and linearly decreases to zero at r = Rth1.","id_\u9060\u8DDD\u96E2\u529B\u8AAC\u660E":"The long-range force has its maximum value at r = Rth2 and linearly decreases to zero at r = Rth1 and r = Rmax.","id_\u6E1B\u8870\u91CF\u8AAC\u660E":"The velocity of a particle is decelerated by multiplying the Decel factor at each calculation step.","id_\u63FA\u52D5\u8AAC\u660E":"Random number ranging \xB1 1/2,000 of Perturb is added to the velocity at each calculation step.","id_rowdiv\u8AAC\u660E":"RowDiv is an optimization parameter for interaction calculation. Giving 3 or 4 will be the fastest. It only affects the calculation speed and should not affect the calculation result.","id_canvasMode\u8AAC\u660E":"When WebGL is unavailable, Firefox''s rendering becomes very slow. You can choose '2d (source-over)' for Canvas Rendering Mode to make it faster at the expense of rendring quality.","#_arg1_ \u304C #_arg2_ \u304B\u3089\u53D7\u3051\u308B\u529B (\u8FD1 _arg3_, \u9060 _arg4_)":"Force from #_arg2_ to #_arg1_ (near _arg3_, far _arg4_)","\u9589\u3058\u308B":"Close","\u6B21\u3078":"Next","\u3053\u3053\uFF01":"Here!","\u524D\u3078":"Prev","id_new-world_help":'This is a website where you can leisurely walk across the worlds where particles come to life.<br><br>When you get bored, you can move to a different world by pressing "Next World".',"id_recommendation_help":'Select some recommended config under "World Config.", then try pressing "Next World" a few times.',"id_full-screen_help":'You can enjoy full screen view by pressing "Full Screen <span class="icon"><ion-icon name="expand"></ion-icon></span>".<br><br>While in full-screen view, you can move to the next world by double-click/tap on peripheral area or pressing "N" key.',"id_particles-display_help":"You can stick your finger into the world by double click/tap on the main screen.","id_copy-url_help":'You can copy URL for the current world by pressing "Share this world <span class="icon"><ion-icon name="share-social"></ion-icon></span></a>".',"id_palette_help":'You can tweak the color palette by pressing <span class="icon"><ion-icon name="color-palette"></ion-icon></span> under "Rendering control".',"id_replay_help":'You can replay the world from the begining by pressing <span class="icon"><ion-icon name="play-skip-back"></ion-icon></span> under "Rendering control".<br><br>So, enjoy!'}};var CanvasRenderer=class{constructor(canvas,render,onrecorded){this.canvas=canvas;this.render=render;this.minPeriod=50;this.requestID=null;this.recoder=null;this.onrecorded=onrecorded;this.requestStop=false;this.averagePeriod=1}get fps(){return 1e3/this.averagePeriod}get maxFps(){return 1e3/this.minPeriod}set maxFps(v){if(v>0){this.minPeriod=1e3/v}else{this.minPeriod=0}}start(resetCounter){this.counter??=0;if(resetCounter)this.counter=0;this.requestStop=false;if(!this.requestID)this.requestID=window.requestAnimationFrame(ts=>this.frame(ts))}stop(){if(this.requestID!=null)window.cancelAnimationFrame(this.requestID);this.requestStop=true;this.requestID=null}startRecording(){const chunks=[];const stream=this.canvas.captureStream();this.rec=new MediaRecorder(stream);this.rec.ondataavailable=e=>chunks.push(e.data);this.rec.onstop=()=>this.onrecorded(new Blob(chunks,{type:"video/webm"}));this.rec.start()}stopRecording(){this.rec.stop();this.rec=null}cancelRecording(){this.rec.onstop=null;this.stopRecording()}async frame(ts){if(this.requestStop)return this.requestID=null;const period=ts-(this.last_ts||ts-10);this.last_ts=ts;if(this.minPeriod>0&&period<this.minPeriod){await util.sleep(this.minPeriod-period);this.averagePeriod=this.averagePeriod*.95+this.minPeriod*.05}else{this.averagePeriod=this.averagePeriod*.95+period*.05}if(this.requestStop)return this.requestID=null;this.counter++;this.render(ts,this.canvas);this.requestID=window.requestAnimationFrame(ts2=>this.frame(ts2))}};var interactionSets={"":(interaction,rand)=>interaction.set((i,j)=>i==j?[-(.001+5e-4*rand.next()),.001*(rand.next()-.5)]:[-(5e-4+5e-4*rand.next()),.001*(rand.next()-.5)]),"A":(interaction,rand)=>interaction.set((i,j)=>i==j?[-(.001+5e-4*rand.next()),.001*(rand.next()-.5)]:[-(.001+5e-4*rand.next()),.001*rand.next()**6*(rand.next()>.7?1:-1)]),"B":(interaction,rand)=>interaction.set((i,j)=>i==j?[-(.001+5e-4*rand.next()),.001*(rand.next()-.5)]:[-(.001+5e-4*rand.next()),5e-4*rand.next()**6*(rand.next()>.7?1:-1)])};var ColorScale=class{constructor(mapping){mapping||=[[0,0,0,0],[1,255,255,255]];this.mapping=mapping}static rgb2str(r,g,b2){[r,g,b2]=[r,g,b2].map(x=>Math.round(x));const hex=x=>("0"+x.toString(16)).slice(-2);return"#"+hex(r)+hex(g)+hex(b2)}static hsl2rgb(h,s,l){const c=(1-Math.abs(2*l-1))*s;const x=c*(1-Math.abs(h*6%2-1));const m=l-c/2;let r,g,b2;if(h*6<1){r=c;g=x;b2=0}else if(h*6<2){r=x;g=c;b2=0}else if(h*6<3){r=0;g=c;b2=x}else if(h*6<4){r=0;g=x;b2=c}else if(h*6<5){r=x;g=0;b2=c}else{r=c;g=0;b2=x}return[(r+m)*255,(g+m)*255,(b2+m)*255]}color(x){const{mapping}=this;x=Math.max(0,Math.min(1,x));let i=mapping.findIndex(entry=>x<=entry[0]);if(i==0){return ColorScale.rgb2str(mapping[0][1],mapping[0][2],mapping[0][3])}let r=(x-mapping[i-1][0])/(mapping[i][0]-mapping[i-1][0]);return ColorScale.rgb2str(mapping[i-1][1]*(1-r)+mapping[i][1]*r,mapping[i-1][2]*(1-r)+mapping[i][2]*r,mapping[i-1][3]*(1-r)+mapping[i][3]*r)}};var colorScaleList=[new ColorScale([[0/6,...ColorScale.hsl2rgb(0/6,1,.5)],[1/6,...ColorScale.hsl2rgb(1/6,1,.5)],[2/6,...ColorScale.hsl2rgb(2/6,1,.5)],[3/6,...ColorScale.hsl2rgb(3/6,1,.5)],[4/6,...ColorScale.hsl2rgb(4/6,1,.5)],[5/6,...ColorScale.hsl2rgb(5/6,1,.5)],[6/6,...ColorScale.hsl2rgb(6/6,1,.5)]]),new ColorScale([[0/4,0,255,255],[1/4,0,0,192],[2/4,0,0,0],[3/4,192,0,0],[4/4,255,255,0]]),new ColorScale([[0/4,0,255,255],[1/4,0,0,192],[2/4,255,255,255],[3/4,192,0,0],[4/4,255,255,0]]),new ColorScale([[0/6,...ColorScale.hsl2rgb(0/6,1,.3)],[1/6,...ColorScale.hsl2rgb(1/6,1,.3)],[2/6,...ColorScale.hsl2rgb(2/6,1,.3)],[3/6,...ColorScale.hsl2rgb(3/6,1,.3)],[4/6,...ColorScale.hsl2rgb(4/6,1,.3)],[5/6,...ColorScale.hsl2rgb(5/6,1,.3)],[6/6,...ColorScale.hsl2rgb(6/6,1,.3)]]),new ColorScale([[0/6,...ColorScale.hsl2rgb(0/6,1,.7)],[1/6,...ColorScale.hsl2rgb(1/6,1,.7)],[2/6,...ColorScale.hsl2rgb(2/6,1,.7)],[3/6,...ColorScale.hsl2rgb(3/6,1,.7)],[4/6,...ColorScale.hsl2rgb(4/6,1,.7)],[5/6,...ColorScale.hsl2rgb(5/6,1,.7)],[6/6,...ColorScale.hsl2rgb(6/6,1,.7)]])];var PLInteractionMatrix=class{constructor(world){this.update(world)}update(world){this.world=world;if(this.matrix==null){this.matrix=[...Array(world.nspecies)].map(()=>[...Array(world.nspecies)].map(()=>[0,0]))}else if(this.matrix.length!=world.nspecies){this.matrix=[...Array(world.nspecies)].map((_,i)=>[...Array(world.nspecies)].map((_2,j)=>i<this.matrix.length&&j<this.matrix.length?this.matrix[i][j]:[0,0]))}let len=3*world.nspecies*world.nspecies*2;if(this.mem==null){this.mem=wasm.i32.alloc(len*4)}else if(this.mem.length<len){let size=Math.max(this.mem.length*4,len);this.mem.free;this.mem=wasm.i32.alloc(size)}}destructor(){this.mem.free}set(func_or_i,j,a2,b2){if(func_or_i&&typeof func_or_i==="function"){const func=func_or_i;for(let i=0;i<this.world.nspecies;i++)for(let j2=0;j2<this.world.nspecies;j2++)this.set(i,j2,...func(i,j2))}else{const i=func_or_i;this.matrix[i][j]=[a2,b2];this.convert(i,j)}}get(i,j){return this.matrix[i][j]}convert(i,j){const[a2,b2]=this.matrix[i][j];const world=this.world;const n=world.nspecies;let aa=a2/world.rth1;let bb=b2/(world.rth2-world.rth1);let cc=b2/(world.rmax-world.rth2);aa*=world.step*world.scale*2**32;bb*=world.step*world.scale*2**32;cc*=world.step*world.scale*2**32;this.mem[3*(i*n*2+j)+0]=aa;this.mem[3*(i*n*2+j)+1]=bb;this.mem[3*(i*n*2+j)+2]=cc;this.mem[3*(j*n*2+i+n)+0]=aa;this.mem[3*(j*n*2+i+n)+1]=bb;this.mem[3*(j*n*2+i+n)+2]=cc}convertAll(){for(let i=0;i<this.world.nspecies;i++)for(let j=0;j<this.world.nspecies;j++)this.convert(i,j)}copyFrom(another){if(this.world.nspecies!=another.world.nspecies)return;for(let i=0;i<this.world.nspecies;i++)for(let j=0;j<this.world.nspecies;j++)this.set(i,j,...another.get(i,j))}};var PLParticles=class{constructor(nparticles){this.update(nparticles)}update(nparticles){this.n=Math.floor(nparticles);let len=(6+2)*nparticles+2;if(!this.mem){this.mem=wasm.i32.alloc(len*4);this.memVertices=new Int16Array(5*nparticles*4*4)}else if(this.mem.length<len){let size=Math.max(this.mem.length*4,len);this.mem.free;this.mem=wasm.i32.alloc(size);this.memVertices=new Int16Array(5*size/8*4*4)}}destructor(){this.mem.free}set(i,species,x,y,vx,vy){if(i<0||this.n<=i)return;this.mem[6*i+0]=species;this.mem[6*i+2]=x*2**32;this.mem[6*i+3]=y*2**32;this.mem[6*i+4]=vx*2**32;this.mem[6*i+5]=vy*2**32}get(i){if(i<0||this.n<=i)return;return[this.mem[6*i+0],this.mem[6*i+2]/2**32,this.mem[6*i+3]/2**32,this.mem[6*i+4]/2**32,this.mem[6*i+5]/2**32]}forEach(func){for(let i=0;i<this.n;i++)func(this.mem[6*i+0],this.mem[6*i+2]/2**32,this.mem[6*i+3]/2**32)}vertices(palette,psize){const v=this.memVertices;const n=this.n;const mem=this.mem;psize*=65536;let j=0;for(let i=0;i<n;i++){const px=mem[6*i+2]>>>16;const py=mem[6*i+3]>>>16;const c=palette[mem[6*i+0]];const register2=(_px,_py)=>{v[5*j]=+_px/2-32768/2;v[5*j+1]=(65536-_py)/2-32768/2;v[5*j+2]=c[0]*127;v[5*j+3]=c[1]*127;v[5*j+4]=c[2]*127;j++};const register3=(_px,_py)=>{register2(_px,_py);if(_py<psize)register2(_px,_py+65536);if(_py>65536-psize)register2(_px,_py-65536)};register3(px,py);if(px<psize)register3(px+65536,py);if(px>65536-psize)register3(px-65536,py)}return[v,j]}};var ParticleLife=class{constructor(options={},rand){this.update(options,rand)}update(options,rand=this.rand){const defaultParams=util.importOptions({},this,{nspecies:6,nlattice:30,rth1:.05,rth2:.1,rmax:.2,perturb:.001,decel:.499,scale:1,step:1,row_div:3});util.importOptions(this,options,defaultParams);this.rand=rand;this.nparticles=this.nlattice*this.nlattice;if(!this.interaction){this.interaction=new PLInteractionMatrix(this)}else{this.interaction.update(this)}if(!this.particles){this.particles=new PLParticles(this.nparticles)}else{this.particles.update(this.nparticles)}let ncol=Math.floor(2**32/Math.round(this.rmax/this.scale*2**32));if(ncol<=2)ncol=1;let nrow=ncol*this.row_div;let len=8+(ncol*nrow+1+this.row_div+1)*4;if(!this.mem){this.mem=wasm.i32.alloc(len*4)}else if(this.mem.length<len){let size=Math.max(this.mem.length*4,len);this.mem.free;this.mem=wasm.i32.alloc(size)}this.mem[0]=this.nspecies;this.mem[1]=this.nparticles;this.mem[2]=this.rth1/this.scale*2**32;this.mem[3]=this.rth2/this.scale*2**32;this.mem[4]=this.rmax/this.scale*2**32;this.mem[5]=this.perturb/this.scale*2**32;this.mem[6]=this.decel*2**30;this.mem[7]=this.row_div}destructor(){this.mem.free;util.destruct(this.rand);util.destruct(this.interaction);util.destruct(this.particles)}setupParticles(func){for(let i=0;i<this.nlattice;i++){for(let j=0;j<this.nlattice;j++){this.particles.set(i*this.nlattice+j,...func(i,j))}}}interactParticles(){wasm.interactParticles(this.mem.ptr,this.interaction.mem.ptr,this.particles.mem.ptr)}repelParticles(repelX,repelY){if(isNaN(repelX)||isNaN(repelY))return;for(let i=0;i<this.nparticles;i++){let[species,x,y,vx,vy]=this.particles.get(i);let dx=x-repelX;dx-=Math.round(dx);let dy=y-repelY;dy-=Math.round(dy);let d=Math.hypot(dx,dy);if(d<.2){if(d<.1){vx+=.05*dx/d;vy+=.05*dy/d}else{vx+=.05*(d-.1)*dx/d;vy+=.05*(d-.1)*dy/d}this.particles.set(i,species,x,y,vx,vy)}}}moveParticles(){wasm.moveParticles(this.mem.ptr,this.rand.mem.ptr,this.particles.mem.ptr)}};var XorShift128=class{constructor(seed=Math.random()*2**53,n=1e3){this.mem=wasm.i32.alloc(4);this.mem[3]=seed/2**96&4294967295;this.mem[2]=seed/2**64&4294967295;this.mem[1]=seed/2**32&4294967295;this.mem[0]=seed&4294967295;for(let i=0;i<n;i++)this.next()}destructor(){this.mem.free}next(){return wasm.XorShift128Next(this.mem.ptr)}};var t0={css:`app #fps,[is="app"] #fps{ text-align: right; max-width: 600px; } app .top-buttons,[is="app"] .top-buttons{ position: relative; margin-bottom: 20px; margin-top: 4px; overflow-x: clip; max-width: var(--100vw); white-space: nowrap; } app .top-buttons .button,[is="app"] .top-buttons .button{ margin-right: 5px; } @media screen and (max-width: 420px) { app .top-buttons,[is="app"] .top-buttons{ margin-left: -0.75rem; margin-right: -0.75rem; } } app #copy-url-message,[is="app"] #copy-url-message{ display: block; position: absolute; top: -40px; left: 70px; } app #copy-url-message,[is="app"] #copy-url-message{ display: none; } app #full-screen-message,[is="app"] #full-screen-message{ display: none; position: absolute; top: -50px; left: 30px; } app #world-editor,[is="app"] #world-editor{ display: none; } app.world-editor-shown #world-editor,[is="app"].world-editor-shown #world-editor{ display: block; } app.world-editor-shown pl-controls,[is="app"].world-editor-shown pl-controls{ max-width: 600px; display: block; }`,exports:{onBeforeMount(props,state){this.world=null;this.colorFunc=null;this.displayIntf={world:()=>this.world,colorFunc:()=>this.colorFunc,repelX:NaN,repelY:NaN,update:null,render:null,canvas:null};this.helpPopupIntf={show:null};this.colorScaleEditorIntf={update:null,colorScaleList};this.intEditorIntf={update:null,intColorFunc:(()=>{const colorScale=new ColorScale([[0/4,0,255,255],[1/4,0,0,192],[2/4,0,0,0],[3/4,192,0,0],[4/4,255,255,0]]);return x=>colorScale.color(x)})()};this.controlsIntf={update:null,recommendations:props.recommendations}},onMounted(){this.renderer=new CanvasRenderer(this.displayIntf.canvas(),this.render,blob=>this.update({videoBlob:blob,videoName:this.getWorldURL().split("?")[1]}));this.renderer.maxFps=61;this.setParameters(this.getSearchString(false));this.restart()},updateControlsSetting(options){if(this.root.classList.contains("world-editor-shown")){delete options.perturb}const{tail,screen,particleSize}=options;this.displayIntf.update({tail,screen,particleSize});this.$("color-scale-editor").style.display=options.showPalette?"block":"none";if(options.screen=="F")this.requestFullScreen();this.state.controlsSetting=options;if(options.restart){this.restart(false,false)}else{if(this.world)this.world.update(options)}},onColorScaleEditorUpdate(e){this.colorFunc=e.detail.colorFunc;if(this.intEditorIntf.update)this.intEditorIntf.update();this.displayIntf.render();this.state.paletteSetting=e.detail},displayFps(renderer){const elemFps=document.getElementById("fps");const frame=renderer.counter<1e3?renderer.counter:Math.round(renderer.counter/100)/10+"k";elemFps.innerText=`frame# ${frame}, ${String(renderer.fps).slice(0,4)} fps`},render(){this.world.interactParticles();this.world.repelParticles(this.displayIntf.repelX,this.displayIntf.repelY);this.world.moveParticles();this.displayIntf.render();this.displayFps(this.renderer)},createWorld(randomize=false,fullScreen=false){const options=this.getWorldOptions(randomize,fullScreen);if(this.root.classList.contains("world-editor-shown")){delete options.perturb}if(!this.world){this.world=new ParticleLife(options,new XorShift128(options.world_seed))}else{this.world.update(options,new XorShift128(options.world_seed))}interactionSets[options.intset](this.world.interaction,new XorShift128(options.interact_seed));let distribution=new PLSpeciesDistribution(this.world.nspecies,this.world.rand);this.world.setupParticles((i,j)=>[distribution.species(this.world.rand.next()),i/(this.world.nlattice-1)-.5+.2*(this.world.rand.next()-.5),j/(this.world.nlattice-1)-.5+.2*(this.world.rand.next()-.5),0,0])},restart(randomize=false,fullScreen=false){if(this.world)this.world.recreating=true;try{this.createWorld(randomize,fullScreen)}finally{this.world.recreating=false}this.intEditorIntf.update({world:this.world,colorFunc:x=>this.colorFunc(x)});this.renderer.start(true)},onPauseClick(e){if(e.detail.pause){this.renderer.stop()}else{this.renderer.start()}},onRecordClick(e){if(e.detail.recording){this.renderer.startRecording()}else{this.renderer.stopRecording()}},onRestartFromControls(e){this.renderer.stop();const{randomize,fullScreen}=e.detail;this.restart(randomize,fullScreen)},onFullScreenClick(){const style=this.$("#full-screen-message").style;if(!this.state.fullScreenMessageShown){this.state.fullScreenMessageShown=true;style.display="block";setTimeout(()=>{style.display="none";this.requestFullScreen()},2e3)}else{this.requestFullScreen()}},onCopyUrlClick(){navigator.clipboard.writeText(this.getWorldURL());const style=this.$("#copy-url-message").style;setTimeout(()=>style.display="block",100);setTimeout(()=>style.display="none",1600)},requestFullScreen(){const keydownWhileFullScreen=e=>{if(e.key=="n"||e.key=="N"){this.restart(true,true)}else if(e.key==" "){this.$("#pause").click()}};this.displayIntf.update({screen:"F"});const canvas=document.getElementById("particles-display");canvas.requestFullscreen();canvas.addEventListener("fullscreenchange",e=>{if(!document.fullscreenElement){document.removeEventListener("keydown",keydownWhileFullScreen);this.displayIntf.update({screen:this.state.controlsSetting.screen})}});document.addEventListener("keydown",keydownWhileFullScreen)},num2char(n){const offset=n<10?48:n<10+26?65-10:n<10+26*2?97-10-26:-1;if(offset<0)return"?";return String.fromCharCode(offset+n)},char2num(c){if(c=="?")return NaN;c=c.charAt(0);let n=c.charCodeAt(0);return"a"<=c&&c<="z"?n-97+10+26:"A"<=c&&c<="Z"?n-65+10:"0"<=c&&c<="9"?n-48:NaN},encodeParameters(){const options=this.state.controlsSetting||this.controlsIntf.default_state;let search="?";search+=options.nspecies+"_"+options.nlattice;search+="_"+options.interact_seed+options.intset+"_"+options.world_seed;search+=options.perturb?"":"n";search+="_"+options.tail;search+="_"+options.scale;search+="_"+options.step;const paletteSetting=this.state.paletteSetting;search+="_"+this.num2char(paletteSetting.iscale);search+=("0"+Math.round(paletteSetting.offset*255).toString(16)).slice(-2);search+=("0"+Math.round(paletteSetting.scale*16-16).toString(16)).slice(-2);search+=Math.round(options.particleSize*2);return search},getSearchString(randomizeSeeds=false){return this.controlsIntf.getSearchString(this.encodeParameters(),randomizeSeeds)},setParameters(search,fullScreen=false){let result=this.parseParameters(search);if(fullScreen)result.screen="F";this.controlsIntf.update(result);this.colorScaleEditorIntf.update(result.paletteSetting)},parseParameters(search){if(!search)search=this.getSearchString(true);let result=Object.assign({},this.controlsIntf.default_state);let displaySetting;let options=search.substring(1).split("_");if(options.length==4){[result.nspecies,result.nlattice,result.interact_seed,result.world_seed]=options}else if(options.length==5){[result.nspecies,result.nlattice,result.interact_seed,result.world_seed,result.tail]=options}else if(options.length==6){[result.nspecies,result.nlattice,result.interact_seed,result.world_seed,result.tail,result.scale]=options}else if(options.length==7){[result.nspecies,result.nlattice,result.interact_seed,result.world_seed,result.tail,result.scale,result.step]=options}else if(options.length==8){[result.nspecies,result.nlattice,result.interact_seed,result.world_seed,result.tail,result.scale,result.step,displaySetting]=options}else{return{}}let match=/^(.*)n$/.exec(result.world_seed);if(match){result.world_seed=match[1];result.perturb=0}match=/^(XS|S|M|L|F)(.+)/.exec(result.nspecies);if(match){result.screen=match[1];result.nspecies=match[2]}result.screen="S";if(/[A-Z]/.test(result.interact_seed.slice(-1))){result.intset=result.interact_seed.slice(-1);result.interact_seed=result.interact_seed.slice(0,-1)}if(displaySetting){this.state.paletteSetting||={};this.state.paletteSetting.iscale=this.char2num(displaySetting.slice(0,1),16);if(displaySetting.slice(1,3)=="xx"){displaySetting=displaySetting.slice(0,1)+("0"+Math.round(Math.random()*255).toString(16)).slice(-2)+displaySetting.slice(3)}this.state.paletteSetting.offset=parseInt(displaySetting.slice(1,3),16)/255;if(displaySetting.slice(3,5)=="xx"){let rand=Math.random()**4;if(rand<.2)rand=0;displaySetting=displaySetting.slice(0,3)+("0"+Math.round(rand*32).toString(16)).slice(-2)+displaySetting.slice(5)}this.state.paletteSetting.scale=1+parseInt(displaySetting.slice(3,5),16)/16;result.particleSize=displaySetting.slice(5)/2}return result},getWorldOptions(randomize,fullScreen){if(randomize)this.setParameters(this.getSearchString(randomize),fullScreen);return this.state.controlsSetting},getWorldURL(){return location.href.replace(/[^\/]*$/,this.encodeParameters())}},template:(template,expressionTypes2,bindingTypes2,getComponent)=>template('<section><p><i18n expr92="expr92"></i18n><br class="weak"/><i18n expr93="expr93"></i18n></p><div id="fps"></div><div class="columns is-desktop"><div class="column is-narrow" style="line-height:1;position:relative;"><particles-display expr94="expr94" width="600" height="600"></particles-display><br/><color-scale-editor expr95="expr95" width="600" height="40"></color-scale-editor><div class="top-buttons"><a expr96="expr96" class="button is-info is-small" id="new-world"><i18n expr97="expr97"></i18n></a><a expr98="expr98" class="button is-info is-small" id="copy-url"><i18n expr99="expr99"></i18n>&nbsp;&nbsp;&nbsp;\r\n              <span class="icon"><ion-icon expr100="expr100" name="share-social"></ion-icon></span></a><div class="block" id="copy-url-message"><span class="tag is-success"><i18n expr101="expr101"></i18n></span></div><a expr102="expr102" class="button is-info is-small" id="full-screen"><i18n expr103="expr103"></i18n> &nbsp; \r\n              <span class="icon"><ion-icon expr104="expr104" name="expand"></ion-icon></span></a><div class="block" id="full-screen-message"><span class="tag is-success"><i18n expr105="expr105"></i18n></span></div></div><pl-controls expr106="expr106"></pl-controls></div><div class="column is-narrow" id="world-editor"><interaction-editor expr107="expr107" width="600"></interaction-editor></div></div><video-holder expr108="expr108"></video-holder><div class="content"><help-popup expr109="expr109"></help-popup></div><section></section></section>',[{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u7C92\u5B50\u306B\u547D\u304C\u5BBF\u308B\u4E16\u754C\u3092\u306E\u3093\u3073\u308A\u773A\u3081\u308B\u30B5\u30A4\u30C8\u3067\u3059\u3002",bindings:[]}],attributes:[],redundantAttribute:"expr92",selector:"[expr92]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u98FD\u304D\u305F\u3089\u300C\u6B21\u306E\u30EF\u30FC\u30EB\u30C9\u3092\u751F\u6210\u300D\u3092\u62BC\u3057\u3066\u4E0B\u3055\u3044\u3002",bindings:[]}],attributes:[],redundantAttribute:"expr93",selector:"[expr93]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"particles-display",slots:[],attributes:[{type:expressionTypes2.EVENT,name:"on-restart",evaluate:_scope=>()=>_scope.restart(true,true)},{type:expressionTypes2.ATTRIBUTE,name:"intf",evaluate:_scope=>_scope.displayIntf}],redundantAttribute:"expr94",selector:"[expr94]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"color-scale-editor",slots:[],attributes:[{type:expressionTypes2.EVENT,name:"on-update",evaluate:_scope=>_scope.onColorScaleEditorUpdate},{type:expressionTypes2.ATTRIBUTE,name:"intf",evaluate:_scope=>_scope.colorScaleEditorIntf}],redundantAttribute:"expr95",selector:"[expr95]"},{redundantAttribute:"expr96",selector:"[expr96]",expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>()=>_scope.restart(true)}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u6B21\u306E\u30EF\u30FC\u30EB\u30C9\u3092\u751F\u6210",bindings:[]}],attributes:[],redundantAttribute:"expr97",selector:"[expr97]"},{redundantAttribute:"expr98",selector:"[expr98]",expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>_scope.onCopyUrlClick}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u3053\u306E\u30EF\u30FC\u30EB\u30C9\u3092\u30B7\u30A7\u30A2",bindings:[]}],attributes:[],redundantAttribute:"expr99",selector:"[expr99]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"ion-icon",slots:[],attributes:[],redundantAttribute:"expr100",selector:"[expr100]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u3053\u306E\u30EF\u30FC\u30EB\u30C9\u3078\u306E URL \u3092\u30B3\u30D4\u30FC\u3057\u307E\u3057\u305F",bindings:[]}],attributes:[],redundantAttribute:"expr101",selector:"[expr101]"},{redundantAttribute:"expr102",selector:"[expr102]",expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>_scope.onFullScreenClick}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u5168\u753B\u9762",bindings:[]}],attributes:[],redundantAttribute:"expr103",selector:"[expr103]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"ion-icon",slots:[],attributes:[],redundantAttribute:"expr104",selector:"[expr104]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u753B\u9762\u5916\u306E\u30C0\u30D6\u30EB\u30BF\u30C3\u30D7\u3067\u6B21\u306E\u30EF\u30FC\u30EB\u30C9\u3092\u751F\u6210\u3067\u304D\u307E\u3059",bindings:[]}],attributes:[],redundantAttribute:"expr105",selector:"[expr105]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"pl-controls",slots:[],attributes:[{type:expressionTypes2.ATTRIBUTE,name:"intf",evaluate:_scope=>_scope.controlsIntf},{type:expressionTypes2.EVENT,name:"on-show-editor",evaluate:_scope=>()=>_scope.root.classList.toggle("world-editor-shown")},{type:expressionTypes2.EVENT,name:"on-record",evaluate:_scope=>_scope.onRecordClick},{type:expressionTypes2.EVENT,name:"on-restart",evaluate:_scope=>_scope.onRestartFromControls},{type:expressionTypes2.EVENT,name:"on-pause",evaluate:_scope=>_scope.onPauseClick},{type:expressionTypes2.EVENT,name:"on-update",evaluate:_scope=>e=>_scope.updateControlsSetting(e.detail)},{type:expressionTypes2.EVENT,name:"on-help",evaluate:_scope=>()=>_scope.helpPopupIntf.show()},{type:expressionTypes2.EVENT,name:"on-full-screen",evaluate:_scope=>()=>_scope.requestFullScreen()}],redundantAttribute:"expr106",selector:"[expr106]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"interaction-editor",slots:[],attributes:[{type:expressionTypes2.ATTRIBUTE,name:"intf",evaluate:_scope=>_scope.intEditorIntf},{type:expressionTypes2.EVENT,name:"on-max-fps-change",evaluate:_scope=>()=>{if(_scope.renderer)_scope.renderer.maxFps=_scope.$("#max-fps").value}}],redundantAttribute:"expr107",selector:"[expr107]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"video-holder",slots:[],attributes:[{type:expressionTypes2.ATTRIBUTE,name:"data-blob",evaluate:_scope=>_scope.state.videoBlob},{type:expressionTypes2.ATTRIBUTE,name:"data-name",evaluate:_scope=>_scope.state.videoName}],redundantAttribute:"expr108",selector:"[expr108]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"help-popup",slots:[{id:"default",html:'<ul><li expr110="expr110"></li></ul>',bindings:[{type:bindingTypes2.EACH,getKey:null,condition:null,template:template('<raw expr111="expr111"></raw>',[{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"raw",slots:[],attributes:[{type:expressionTypes2.ATTRIBUTE,name:"html",evaluate:_scope=>_scope.message}],redundantAttribute:"expr111",selector:"[expr111]"}]),redundantAttribute:"expr110",selector:"[expr110]",itemName:"message",indexName:null,evaluate:_scope=>_scope.messages}]}],attributes:[{type:expressionTypes2.ATTRIBUTE,name:"intf",evaluate:_scope=>_scope.helpPopupIntf}],redundantAttribute:"expr109",selector:"[expr109]"}]),name:"app"};var t1={css:null,exports:{setInnerHTML(){this.root.innerHTML=this.props.html},onMounted(){this.setInnerHTML()},onUpdated(){this.setInnerHTML()}},template:null,name:"raw"};var t2={css:`particles-display,[is="particles-display"]{ line-height: 1; } particles-display > div,[is="particles-display"] > div{ margin: 0px; } particles-display canvas,[is="particles-display"] canvas{ touch-action: none; margin: 0px; max-width: var(--100vw); max-height: var(--100vw); } @media screen and (max-width: 640px) { particles-display canvas,[is="particles-display"] canvas{ margin-left: -0.75rem; margin-right: -0.75rem; } } @media screen and (min-width: 1000px) { particles-display canvas,[is="particles-display"] canvas{ min-width: 600px; } }`,exports:{onBeforeMount(props,state){Object.assign(state,{offsetX:0,offsetY:0,tail:0,particleSize:3});props.intf.update=(...args)=>this.update(...args);props.intf.render=(...args)=>this.render(...args);props.intf.canvas=()=>this.$("canvas")},onMounted(){this.registerPointerHandlers()},registerPointerHandlers(){const canvas=this.$("#particles-display");const mouse2xySub=(mouseX,mouseY)=>{const size=Math.min(canvas.clientWidth,canvas.clientHeight);const ox=(canvas.clientWidth-size)/2;const oy=(canvas.clientHeight-size)/2;const x=(mouseX-ox)/size+this.state.offsetX;const y=(mouseY-oy)/size+this.state.offsetY;return[x,y]};const mouse2xy=(mouseX,mouseY)=>{const[x,y]=mouse2xySub(mouseX,mouseY);return[x-Math.round(x),y-Math.round(y)]};const mouseInDisplay=(mouseX,mouseY)=>{const[x,y]=mouse2xySub(mouseX,mouseY);return 0<x&&x<1&&0<y&&y<1};let canvasTapCount=0;let mouseDoubleDown=false;this.defineDragBehavior(canvas,{down:(e,x,y)=>{e.preventDefault();if(canvasTapCount==0){canvasTapCount++;setTimeout(()=>{canvasTapCount=0},350)}else{canvasTapCount=0;if(!mouseInDisplay(x,y)){this.dispatchEvent("restart");return}mouseDoubleDown=true;[this.props.intf.repelX,this.props.intf.repelY]=mouse2xy(x,y)}},move:(e,mouseDown,newX2,newY2,oldX,oldY)=>{if(mouseDown){e.preventDefault();if(!mouseDoubleDown){const[dx,dy]=[newX2-oldX,newY2-oldY];const size=Math.min(canvas.clientWidth,canvas.clientHeight);this.state.offsetX-=dx/size;this.state.offsetX-=Math.round(this.state.offsetX);this.state.offsetY-=dy/size;this.state.offsetY-=Math.round(this.state.offsetY);this.render()}else{[this.props.intf.repelX,this.props.intf.repelY]=mouse2xy(newX2,newY2)}}},up:(e,x,y)=>{mouseDoubleDown=false;[this.props.intf.repelX,this.props.intf.repelY]=[NaN,NaN]}})},onUpdated(props,state){const screens={XS:400,S:600,M:900,L:1200,XL:1500,F:Math.min(window.screen.width,window.screen.height)};this.state.size=screens[this.state.screen]??600;let[w,h]=[this.state.size,this.state.size];if(this.state.screen=="F")[w,h]=[window.screen.width,window.screen.height];let canvas=this.$("canvas");[canvas.style.width,canvas.style.height]=[w+"px",h+"px"];const r=window.devicePixelRatio;this.state.size*=r;[canvas.width,canvas.height]=[w*r,h*r];this.render()},calcParticleSize(){return this.state.particleSize/600*this.state.size},render2dCore(g,world,colorFunc){this.$("canvas");g.setTransform(1,0,0,1,0,0);g.scale(this.state.size,this.state.size);g.translate(.5,.5);const n=world.nspecies;const palette=[...Array(n)].map((_,i)=>colorFunc(i/n));let particleSize=this.calcParticleSize();const r=particleSize/this.state.size/2;world.particles.forEach((sp,x,y)=>{const draw2=(_x,_y)=>{g.beginPath();g.fillStyle=palette[sp];g.arc(_x,_y,r,0,2*Math.PI);g.fill()};const draw=(_x,_y)=>{draw2(_x,_y);if(_y<-.5+r)draw2(_x,_y+1);if(_y>.5-r)draw2(_x,_y-1)};x+=.5;x-=Math.round(x);y+=.5;y-=Math.round(y);draw(x,y);if(x<-.5+r)draw(x+1,y);if(x>.5-r)draw(x-1,y)})},drawImageWithOffset(g,source){const s=this.state.size;const[dx,dy]=[-this.state.offsetX*s,-this.state.offsetY*s];const region=(sx,sy)=>{const x1=(s-dx)%s;const y1=(s-dy)%s;const x2=(dx+s)%s;const y2=(dy+s)%s;return[Math.min(x1,sx?0:s),Math.min(y1,sy?0:s),Math.abs(x1-(sx?0:s)),Math.abs(y1-(sy?0:s)),Math.min(x2,sx?s:0),Math.min(y2,sy?s:0),Math.abs(x1-(sx?0:s)),Math.abs(y1-(sy?0:s))]};g.drawImage(source,...region(0,0));g.drawImage(source,...region(1,0));g.drawImage(source,...region(0,1));g.drawImage(source,...region(1,1))},ParticleRendererGL:class{constructor(gl){this.gl=gl;this.program=this.createProgram(gl);this.vbuffer=new util.glBuffer(gl,gl.ARRAY_BUFFER)}destructor(){if(this.texture){util.finalizer.unregister(this.texture);this.gl.deleteTexture(this.texture)}util.destruct(this.program,this.vbuffer)}createProgram(gl){const vsrc=`
          attribute vec4 a_position;
          attribute vec4 a_color;
          uniform float u_point_size;
          varying vec4 v_color;
          void main(void) {
            gl_Position = a_position;
            gl_Position.x *= 2.0; // \u3042\u3089\u304B\u3058\u3081\u534A\u5206\u306B\u3057\u3066\u6E21\u3057\u3066\u3044\u305F
            gl_Position.y *= 2.0;
            gl_PointSize = u_point_size;
            v_color = a_color;
          }
        `;const fsrc=`
          precision mediump float;
          uniform sampler2D u_texture;
          uniform int       u_use_texture;
          varying vec4      v_color;
          void main(void) {
            vec4 c = vec4(1.0);
            if(bool(u_use_texture)) {
              c = texture2D(u_texture, gl_PointCoord);
            }
            if(c.a == 0.0) {
              discard;
            } else {
              gl_FragColor = v_color * c;
            }
          }
        `;const program=new util.glProgram(gl,vsrc,fsrc,["a_position","a_color"],["u_point_size","u_texture","u_use_texture"]);program.use();return program}loadTexture(src){const gl=this.gl;const img=new Image;img.onload=e=>{let texture;if(this.texture){texture=this.texture;this.texture=null}else{texture=gl.createTexture();util.finalizer.register(this,[gl.deleteTexture,[texture]],texture)}gl.bindTexture(gl.TEXTURE_2D,texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,img);gl.generateMipmap(gl.TEXTURE_2D);gl.bindTexture(gl.TEXTURE_2D,null);this.texture=texture};img.src=src}render(nTexture,w,h,world,colorFunc,particleSize,frameBuffer=null){if(frameBuffer){frameBuffer.bind(()=>this.#renderCore(nTexture,w,h,world,colorFunc,particleSize))}else{this.#renderCore(nTexture,w,h,world,colorFunc,particleSize)}}#renderCore(nTexture,w,h,world,colorFunc,particleSize){const{gl,program,vbuffer,texture}=this;program.use();if(texture&&nTexture>=0){program.u_texture.i=nTexture;gl.activeTexture(gl[`TEXTURE${nTexture}`]);gl.bindTexture(gl.TEXTURE_2D,texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR);program.u_use_texture.i=true}else{program.u_use_texture.i=false}gl.viewport(0,0,w,h);gl.disable(gl.DEPTH_TEST);gl.enable(gl.BLEND);gl.blendFunc(gl.ONE_MINUS_DST_COLOR,gl.ONE);gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT);program.u_point_size.f=Number.parseFloat(particleSize)+.25;let palette=[...Array(world.nspecies)].map((_,i)=>{const c=colorFunc(i/world.nspecies);return[parseInt(c.slice(1,3),16),parseInt(c.slice(3,5),16),parseInt(c.slice(5,7),16)]});const[vertices,nvertices]=world.particles.vertices(palette,particleSize/w);if((vbuffer.dataLength||0)<vertices.length){vbuffer.data(vertices,gl.DYNAMIC_DRAW)}else{vbuffer.subData(0,vertices)}let size=2;program.a_position.ptr=[vbuffer,2,gl.SHORT,true,size*5,0];program.a_color.ptr=[vbuffer,3,gl.SHORT,true,size*5,size*2];vbuffer.bind(()=>{gl.drawArrays(gl.POINTS,0,nvertices)})}},recreateCanvas(canvas){const clone=canvas.cloneNode();canvas.replaceWith(clone);canvas.width=0;canvas.height=0;this.registerPointerHandlers();return clone},render(){const world=this.props.intf.world();const colorFunc=this.props.intf.colorFunc();if(!world||!colorFunc)return;if(world.recreating)return;let canvas=this.$("canvas");const canvasMode=document.getElementById("canvas-mode");if(canvasMode.value=="webgl"){let gl=canvas.getContext("webgl");if(!gl){canvas=this.recreateCanvas(canvas);gl=canvas.getContext("webgl")}if(gl){if(this.buffer2){this.buffer2.width=0;delete this.buffer2;this.buffer3.width=0;delete this.buffer3}this.renderGL(gl,canvas,world,colorFunc);return}canvasMode.value="screen";document.querySelector('#canvas-mode option[value="webgl"]').disabled=true}util.destruct(this.rendererGL,this.frameBuffer1,this.frameBuffer2A,this.frameBuffer2B,this.frameRendererTail,this.frameRendererOffset);delete this.rendererGL;delete this.frameBuffer1;delete this.frameBuffer2A;delete this.frameBuffer2B;delete this.frameRendererTail;delete this.frameRendererOffset;let g=canvas.getContext("2d");if(!g){canvas=this.recreateCanvas(canvas);g=canvas.getContext("2d")}if(!g){throw new Error("canvas 2d context is not available")}this.render2d(g,canvas,world,colorFunc)},render2d(g,canvas,world,colorFunc){const s=this.state.size;const w=canvas.width;const h=canvas.height;if(!this.buffer2){this.buffer2=canvas.cloneNode();this.buffer3=canvas.cloneNode()}else if(this.buffer2.width!=w||this.buffer2.height!=h){this.buffer2.width=w;this.buffer2.height=h;this.buffer3.width=w;this.buffer3.height=h}const g3=this.buffer3.getContext("2d");g3.globalCompositeOperation="source-over";g3.setTransform(1,0,0,1,0,0);g3.fillStyle="#000000";g3.fillRect(0,0,w,h);const canvasMode=document.getElementById("canvas-mode");if(canvasMode.value=="screen"){g3.globalCompositeOperation="screen"}else{g3.globalCompositeOperation="source-over"}this.render2dCore(g3,world,colorFunc);const g2=this.buffer2.getContext("2d");this.render2dBackground(g2,w,h);g2.globalCompositeOperation="lighten";g2.drawImage(this.buffer3,0,0);g.setTransform(1,0,0,1,0,0);g.translate((w-s)/2,(h-s)/2);this.drawImageWithOffset(g,this.buffer2);if(w>s){g.setTransform(1,0,0,1,0,0);g.translate((w-s)/2-s,(h-s)/2);this.drawImageWithOffset(g,this.buffer2);g.setTransform(1,0,0,1,0,0);g.translate((w-s)/2+s,(h-s)/2);this.drawImageWithOffset(g,this.buffer2);g.fillStyle="#00000080";g.setTransform(1,0,0,1,0,0);g.fillRect(0,0,(w-s)/2,h);g.fillRect((w-s)/2+s,0,(w-s)/2,h)}if(h>s){g.setTransform(1,0,0,1,0,0);g.translate((w-s)/2,(h-s)/2-s);this.drawImageWithOffset(g,this.buffer2);g.setTransform(1,0,0,1,0,0);g.translate((w-s)/2,(h-s)/2+s);this.drawImageWithOffset(g,this.buffer2);g.fillStyle="#00000080";g.setTransform(1,0,0,1,0,0);g.fillRect(0,0,w,(h-s)/2);g.fillRect(0,(h-s)/2+s,w,(h-s)/2)}},render2dBackground(g,w,h){let t=this.state.tail;if(t>50){this.tailCount=(this.tailCount??0)+50/t;t=50}else{this.tailCount=1}if(this.tailCount>=1){let style="#000000";if(t>0){style+=("0"+(255/(1+1*t)|0).toString(16)).substr(-2)}g.setTransform(1,0,0,1,0,0);g.fillStyle=style;g.globalCompositeOperation="source-over";g.fillRect(0,0,w,h);g.fillStyle="#010101";g.globalCompositeOperation="difference";g.fillRect(0,0,w,h);this.tailCount-=1}},renderGL(gl,canvas,world,colorFunc){if(!this.rendererGL){this.rendererGL=new this.ParticleRendererGL(gl);this.rendererGL.loadTexture(`data:image/png;base64,
          iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABJklEQVRYw82X
          oW4CQRRFz5sGV9O0+PYLUFiyGsVH9GtQWJJqPqFqFbYGvgB8SxBULSUXwSOp
          IM22XebtsZPZeyc77819Rk0k3QNDYAD0gCfgzpe3wApYAnPg1cw2NIGkvqSp
          pJ3qs/M9/f8IdyWNJVX6O5V/o/tb8UJSqeYoJRV1xUeSFmqehaRRnZNfQ/y7
          ieKnf17q+pQX74RfllyML5ValdFAdS7R5B6egQ756Lgm5h1uDdySl0/gMXl7
          zS2Oaw6T9/YoBskflih6JukdeAgy8GGSvoCbIAOHRDDJw0QU2+RJJopV8hgV
          xTJ5hotiHt+KPb3OAk4/M7PNuQxfgH1G8b1rnp5jM3sDJhkNTFyzRZEsPJS2
          Ipa3YjBpxWiWczi16PH8CAvfPn83UHV5AAAAAElFTkSuQmCC`)}let tail=this.state.tail;if(!this.frameBuffer1){this.frameBuffer1=new util.glFrameBuffer(gl,this.state.size,this.state.size,false);this.frameBuffer2A=new util.glFrameBuffer(gl,this.state.size,this.state.size,false);this.frameBuffer2B=new util.glFrameBuffer(gl,this.state.size,this.state.size,false);const fsrcTail=`
          precision mediump float;
          uniform sampler2D u_texture;
          uniform sampler2D u_texture2;
          uniform float u_tail;
          uniform int u_time;
          uniform vec2 u_size;
          void main(void){
            vec2 uv = gl_FragCoord.xy / u_size;
            vec4 now = texture2D(u_texture, uv);
            vec4 last = texture2D(u_texture2, uv);
            vec4 c;
            float u_tail1 = u_tail + 1.0;
            float comp = u_tail1 / 255.0;
            // \u5272\u5408\u3067\u6E1B\u3089\u306A\u304F\u306A\u3063\u305F\u3089 \u9593\u9694\u3092\u3042\u3051\u3066\u6E1B\u3089\u3059
            c.r = last.r * u_tail / u_tail1; 
            if((last.r - c.r) * 255.0 < 1.0)
              if((u_time - u_time/(int(comp/last.r))*(int(comp/last.r))) == 0) c.r -= 1.0/256.0;
            c.g = last.g * u_tail / u_tail1;
            if((last.g - c.g) * 255.0 < 1.0) 
              if((u_time - u_time/(int(comp/last.g))*(int(comp/last.g))) == 0) c.g -= 1.0/256.0;
            c.b = last.b * u_tail / u_tail1;
            if((last.b - c.b) * 255.0 < 1.0) 
              if((u_time - u_time/(int(comp/last.b))*(int(comp/last.b))) == 0) c.b -= 1.0/256.0;
            c.a = 1.0;
            gl_FragColor = max(c, now);
          }
        `;this.frameRendererTail=new util.glTextureRenderer(gl,fsrcTail,["u_size","u_tail","u_time","u_texture2"]);const fsrcOffset=`
          precision mediump float;
          uniform sampler2D u_texture;
          uniform vec2 u_size;
          uniform vec2 u_offset;
          void main(void){
            // \u3053\u3053\u3067 uv \u304B\u3089 gl_FragColor \u3092\u6C42\u3081\u308B
            float size = min(u_size.x, u_size.y);
            vec2 of = (u_size - size) / 2.0;
            vec2 uv = (gl_FragCoord.xy - of) / size + u_offset;
            uv.x -= floor(uv.x);
            uv.y -= floor(uv.y);
            gl_FragColor = texture2D(u_texture, uv);
            vec2 test = gl_FragCoord.xy - of;
            if(test.x < 0.0 || test.y < 0.0) gl_FragColor.rgb /= 2.0;
            test = gl_FragCoord.xy -size - of;
            if(test.x > 0.0 || test.y > 0.0) gl_FragColor.rgb /= 2.0;
          }
        `;this.frameRendererOffset=new util.glTextureRenderer(gl,fsrcOffset,["u_size","u_offset"]);tail=0;this.counter=1}if(this.frameBuffer1.width!=this.state.size){this.frameBuffer1.resize(this.state.size,this.state.size);this.frameBuffer2A.resize(this.state.size,this.state.size);this.frameBuffer2B.resize(this.state.size,this.state.size);tail=0;this.counter=1}this.rendererGL.render(0,this.state.size,this.state.size,world,colorFunc,this.calcParticleSize(),this.frameBuffer1);let src=this.counter%2==0?this.frameBuffer2A:this.frameBuffer2B;let dest=this.counter%2==0?this.frameBuffer2B:this.frameBuffer2A;this.frameRendererTail.render(1,this.frameBuffer1.texture,(gl2,program)=>{gl2.disable(gl2.BLEND);gl2.disable(gl2.DEPTH_TEST);gl2.viewport(0,0,this.state.size,this.state.size);program.u_tail.f=tail;program.u_size.f=[this.state.size,this.state.size];program.u_time.i=this.count;program.u_texture2.i=2;gl2.activeTexture(gl2.TEXTURE2);gl2.bindTexture(gl2.TEXTURE_2D,src.texture)},dest);this.frameRendererOffset.render(3,dest.texture,(gl2,program)=>{gl2.disable(gl2.BLEND);gl2.disable(gl2.DEPTH_TEST);gl2.viewport(0,0,canvas.width,canvas.height);program.u_size.f=[canvas.width,canvas.height];program.u_offset.f=[this.state.offsetX,-this.state.offsetY]});this.counter+=1}},template:(template,expressionTypes2,bindingTypes2,getComponent)=>template('<canvas expr112="expr112" id="particles-display"></canvas>',[{redundantAttribute:"expr112",selector:"[expr112]",expressions:[{type:expressionTypes2.ATTRIBUTE,name:"width",evaluate:_scope=>_scope.props.width},{type:expressionTypes2.ATTRIBUTE,name:"height",evaluate:_scope=>_scope.props.height}]}]),name:"particles-display"};var t3={css:`pl-controls span.icon,[is="pl-controls"] span.icon{ margin: 0px -2px !important; } pl-controls .columns,[is="pl-controls"] .columns{ display: flex; max-width: var(--100vw); flex-wrap: wrap; } @media screen and (min-width: 420px) and (max-width: 640px) { pl-controls .columns,[is="pl-controls"] .columns{ padding-left: 0.5em; } } pl-controls .is-narrow,[is="pl-controls"] .is-narrow{ flex: none; width: unset; } pl-controls .column.is-narrow.field,[is="pl-controls"] .column.is-narrow.field{ padding: 0.5rem; }`,exports:{async onBeforeMount(props,state){this.i18n=i18n;props.intf.default_state={pause:false,recording:false,interact_seed:2**53*Math.random(),world_seed:2**53*Math.random(),nspecies:6,nlattice:30,scale:3,tail:0,step:1,intset:"",perturb:.001,screen:"S",particleSize:2.5};Object.assign(state,props.intf.default_state);this.recommendations.push(...props.intf.recommendations);props.intf.update=(...args)=>this.update(...args);props.intf.getSearchString=(...args)=>this.getSearchString(...args)},onMounted(props,state){this.flashControl(this.$("#recommendation"),"#ff3");this.$$('input[inputmode="decimal"]').forEach(elem=>elem.autocomplete="off");i18n.addEventListener("update",this.onI18nUpdate)},onUnmounted(props,state){i18n.removeEventListener("update",this.onI18nUpdate)},onI18nUpdate(){this.update()},flashControlCancel:()=>0,async flashControl(control,color){this.flashControlCancel();const original=control.style.backgroundColor;let cancelRequested=false;this.flashControlCancel=()=>{control.style.backgroundColor=original;cancelRequested=true};for(let i=0;i<5;i++){control.style.backgroundColor=color;await util.sleep(400);if(cancelRequested)break;control.style.backgroundColor=original;await util.sleep(400);if(cancelRequested)break}},recommendations:[["\u81EA\u5206\u3067","?"]],recommendationChange(e){if(e.target.value=="?"){this.update()}else{this.dispatchEvent("restart",{randomize:true,fullScreen:false})}this.flashControl(document.getElementById("new-world"),"#880")},editorChanged(e){let{id,value}=e.target;if(e.target.id=="perturb"){this.state.perturb=e.target.checked?.001:0}else if(e.target.id=="scale"){Object.assign(this.state,{scale:value,step:Math.round(this.state.step*this.state.scale/value*1e3)/1e3})}else{this.state[id]=value}this.state.restart=["nspecies","nlattice","scale","intset","step","world_seed","interact_seed"].includes(e.target.id);this.update()},regenerateInteractionSeed(){this.update({interact_seed:2**53*Math.random()});this.dispatchEvent("restart",{randomize:false,fullScreen:false})},regenerateWorldSeed(){this.update({world_seed:2**53*Math.random()});this.dispatchEvent("restart",{randomize:false,fullScreen:false})},onBeforeUpdate(props,state){const rule={pause:"boolean",recording:"boolean",interact_seed:["required","integer","min:1"],world_seed:["required","integer","min:1"],nspecies:["required","integer","between:1,200"],nlattice:["required","integer","between:5,300"],scale:["required","numeric","between:0.5,20"],tail:["required","numeric","min:0"],intset:["regex:/^[A-Z]?$/"],screen:["required"],particleSize:["required","numeric","between:0,127.5"]};state.validation=new Validator(state,rule);state.validation.passes();for(let id of Object.keys(rule)){if(state.validation.errors.errors[id]){this.$("#"+id).classList.add("is-danger");if(this.lastState&&this.lastState[id])state[id]=this.lastState[id]}else{this.$("#"+id).classList.remove("is-danger")}}},onUpdated(props,state){if(state.screen=="F"){state.screen=this.lastState.screen;this.$("#screen").value=state.screen;this.dispatchEvent("update",{...state});this.dispatchEvent("full-screen")}else{this.dispatchEvent("update",{...state})}delete state.restart;this.lastState={...state}},getSearchString(currentSetting,randomizeSeeds=false){let search=this.$("#recommendation").value;if(search=="?")search=currentSetting;if(!search)search=location.search;if(!search){search=this.recommendations.find(rec=>rec.length>2)[1];this.$("#recommendation").value=search}let parts=search.split("_");if(randomizeSeeds){parts[2]=parts[2].replace(/[0-9]+/,2**56*Math.random());parts[3]=parts[3].replace(/[0-9]+/,2**56*Math.random())}else{if(0==parts[2].replace(/[^0-9]+$/,"")){parts[2]=parts[2].replace(/[0-9]+/,this.state.interact_seed||2**56*Math.random())}if(0==parts[3].replace(/[^0-9]+$/,"")){parts[3]=parts[3].replace(/[0-9]+/,this.state.world_seed||2**56*Math.random())}}search=parts.join("_");return search}},template:(template,expressionTypes2,bindingTypes2,getComponent)=>template('<section><div class="columns"><div class="column is-narrow field"><label for="recommendation" class="label"><i18n expr0="expr0"></i18n></label><div expr1="expr1" class="select"><select expr2="expr2" id="recommendation" value><option expr3="expr3" value> </option><option expr4="expr4"></option></select></div></div><div class="column is-narrow field"><label for="interact_seed" class="label"><i18n expr5="expr5"></i18n></label><div class="field has-addons"><p class="control"><button expr6="expr6" class="button" id="replay"><span class="icon is-small"><ion-icon expr7="expr7" name="play-skip-back"></ion-icon></span></button></p><p class="control"><button expr8="expr8" id="pause"><span class="icon is-small"><ion-icon expr9="expr9"></ion-icon></span></button></p><p class="control"><button expr10="expr10" id="recording"><span class="icon is-small"><ion-icon expr11="expr11"></ion-icon></span></button></p><p class="control"><button expr12="expr12" id="palette"><span class="icon is-small"><ion-icon expr13="expr13" name="color-palette"></ion-icon></span></button></p></div></div><div class="column is-narrow field"><label for="particleSize" class="label"><i18n expr14="expr14"></i18n></label><div class="control"><input expr15="expr15" class="input" id="particleSize" inputmode="decimal" size="3" min="0" step="0.5" max="127.5"/></div></div><div class="column is-narrow field"><label for="screen" class="label" style="position:relative;"><i18n expr16="expr16"></i18n> &nbsp; \r\n          <span expr17="expr17" class="icon is-clickable" style="position:absolute;top:-4px;"><ion-icon expr18="expr18" name="expand"></ion-icon></span></label><div class="select"><select expr19="expr19" id="screen"><option value="XS">XS</option><option value="S">S</option><option value="M">M</option><option value="L">L</option><option value="F">Full</option></select></div></div><div class="column is-narrow field"><label class="label"><i18n expr20="expr20"></i18n></label><div class="control"><button expr21="expr21" class="button is-info"><span class="icon is-small"><ion-icon expr22="expr22" name="help"></ion-icon></span></button></div></div></div><div expr23="expr23"><div class="columns"><div class="column is-narrow field"><label for="nspecies" class="label"><i18n expr24="expr24"></i18n></label><div class="control"><input expr25="expr25" class="input" id="nspecies" inputmode="decimal" size="2" min="1" max="200" step="1"/></div></div><div class="column is-narrow field"><label for="nparticles" class="label"><i18n expr26="expr26"></i18n></label><div class="control"><input expr27="expr27" class="input" id="nlattice" inputmode="decimal" size="2" min="5" max="300" step="10"/></div></div><div class="column is-narrow field"><label for="scale" class="label"><i18n expr28="expr28"></i18n></label><div class="control"><input expr29="expr29" class="input" id="scale" inputmode="decimal" size="2" min="0.5" step="0.2" max="20"/></div></div><div class="column is-narrow field"><label for="step" class="label"><i18n expr30="expr30"></i18n></label><div class="control"><input expr31="expr31" class="input" id="step" inputmode="decimal" size="2" min="0" max="2" step="0.1"/></div></div><div class="column is-narrow field"><label for="tail" class="label"><i18n expr32="expr32"></i18n></label><div class="control"><input expr33="expr33" class="input" id="tail" inputmode="decimal" size="2" min="0"/></div></div><div class="column is-narrow field"><label for="perturb" class="label"><i18n expr34="expr34"></i18n></label><div class="control"><input expr35="expr35" id="perturb" type="checkbox"/></div></div></div><div class="columns"><div class="column is-narrow field"><label for="intset" class="label"><i18n expr36="expr36"></i18n></label><div class="select"><select expr37="expr37" id="intset"><option expr38="expr38" value> </option><option expr39="expr39" value="A"> </option><option expr40="expr40" value="B"> </option></select></div></div><div class="column is-narrow field"><label for="interact_seed" class="label"><i18n expr41="expr41"></i18n></label><div class="field has-addons"><div class="control"><input expr42="expr42" class="input" id="interact_seed" inputmode="decimal" size="12" min="1"/></div><div class="control"><a expr43="expr43" class="button is-info"><span class="icon is-small"><ion-icon expr44="expr44" name="refresh"></ion-icon></span></a></div></div></div><div class="column is-narrow field"><label for="world_seed" class="label"><i18n expr45="expr45"></i18n></label><div class="field has-addons"><div class="control"><input expr46="expr46" class="input" id="world_seed" inputmode="decimal" size="12" min="1"/></div><div class="control"><a expr47="expr47" class="button is-info"><span class="icon is-small"><ion-icon expr48="expr48" name="refresh"></ion-icon></span></a></div></div></div></div><a expr49="expr49" class="button is-info is-small" id="show-editor"><i18n expr50="expr50"></i18n></a></div></section>',[{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u30EF\u30FC\u30EB\u30C9\u8A2D\u5B9A",bindings:[]}],attributes:[],redundantAttribute:"expr0",selector:"[expr0]"},{redundantAttribute:"expr1",selector:"[expr1]",expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>()=>_scope.flashControlCancel()}]},{redundantAttribute:"expr2",selector:"[expr2]",expressions:[{type:expressionTypes2.EVENT,name:"onchange",evaluate:_scope=>_scope.recommendationChange}]},{redundantAttribute:"expr3",selector:"[expr3]",expressions:[{type:expressionTypes2.TEXT,childNodeIndex:0,evaluate:_scope=>_scope.i18n.t("URL\u3067")}]},{type:bindingTypes2.EACH,getKey:_scope=>_scope.recommendation[1],condition:null,template:template(" ",[{expressions:[{type:expressionTypes2.TEXT,childNodeIndex:0,evaluate:_scope=>_scope.i18n.t(_scope.recommendation[0])},{type:expressionTypes2.ATTRIBUTE,name:"value",evaluate:_scope=>_scope.recommendation[1]}]}]),redundantAttribute:"expr4",selector:"[expr4]",itemName:"recommendation",indexName:null,evaluate:_scope=>_scope.recommendations},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u63CF\u753B\u5236\u5FA1",bindings:[]}],attributes:[],redundantAttribute:"expr5",selector:"[expr5]"},{redundantAttribute:"expr6",selector:"[expr6]",expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>()=>_scope.dispatchEvent("restart",{randomize:false,fullScreen:false})},{type:expressionTypes2.ATTRIBUTE,name:"title",evaluate:_scope=>_scope.i18n.t("\u59CB\u3081\u306B\u623B\u3063\u3066\u30EA\u30D7\u30EC\u30A4")}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"ion-icon",slots:[],attributes:[],redundantAttribute:"expr7",selector:"[expr7]"},{redundantAttribute:"expr8",selector:"[expr8]",expressions:[{type:expressionTypes2.ATTRIBUTE,name:"class",evaluate:_scope=>_scope.state.pause?"button is-danger":"button"},{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>()=>{_scope.update({"pause":!_scope.state.pause});_scope.dispatchEvent("pause",_scope.state)}},{type:expressionTypes2.ATTRIBUTE,name:"title",evaluate:_scope=>_scope.i18n.t("\u30DD\u30FC\u30BA\uFF0F\u518D\u958B")}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"ion-icon",slots:[],attributes:[{type:expressionTypes2.ATTRIBUTE,name:"name",evaluate:_scope=>_scope.state.pause?"play":"pause"}],redundantAttribute:"expr9",selector:"[expr9]"},{redundantAttribute:"expr10",selector:"[expr10]",expressions:[{type:expressionTypes2.ATTRIBUTE,name:"class",evaluate:_scope=>_scope.state.recording?"button is-danger":"button"},{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>()=>{_scope.update({"recording":!_scope.state.recording});_scope.dispatchEvent("record",_scope.state)}},{type:expressionTypes2.ATTRIBUTE,name:"title",evaluate:_scope=>_scope.i18n.t("webm \u306B\u9332\u753B")}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"ion-icon",slots:[],attributes:[{type:expressionTypes2.ATTRIBUTE,name:"name",evaluate:_scope=>_scope.state.recording?"stop":"ellipse"}],redundantAttribute:"expr11",selector:"[expr11]"},{redundantAttribute:"expr12",selector:"[expr12]",expressions:[{type:expressionTypes2.ATTRIBUTE,name:"class",evaluate:_scope=>_scope.state.showPalette?"button is-dark":"button"},{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>()=>{_scope.update({"showPalette":!_scope.state.showPalette})}},{type:expressionTypes2.ATTRIBUTE,name:"title",evaluate:_scope=>_scope.i18n.t("\u30AB\u30E9\u30FC\u30D1\u30EC\u30C3\u30C8\u7DE8\u96C6")}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"ion-icon",slots:[],attributes:[],redundantAttribute:"expr13",selector:"[expr13]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u7C92\u5F84",bindings:[]}],attributes:[],redundantAttribute:"expr14",selector:"[expr14]"},{redundantAttribute:"expr15",selector:"[expr15]",expressions:[{type:expressionTypes2.VALUE,evaluate:_scope=>_scope.state.particleSize},{type:expressionTypes2.EVENT,name:"onchange",evaluate:_scope=>_scope.editorChanged}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u753B\u9762",bindings:[]}],attributes:[],redundantAttribute:"expr16",selector:"[expr16]"},{redundantAttribute:"expr17",selector:"[expr17]",expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>()=>_scope.update({screen:"F"})}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"ion-icon",slots:[],attributes:[],redundantAttribute:"expr18",selector:"[expr18]"},{redundantAttribute:"expr19",selector:"[expr19]",expressions:[{type:expressionTypes2.VALUE,evaluate:_scope=>_scope.state.screen},{type:expressionTypes2.EVENT,name:"onchange",evaluate:_scope=>_scope.editorChanged}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u4F7F\u3044\u65B9",bindings:[]}],attributes:[],redundantAttribute:"expr20",selector:"[expr20]"},{redundantAttribute:"expr21",selector:"[expr21]",expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>_scope.props.onHelp}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"ion-icon",slots:[],attributes:[],redundantAttribute:"expr22",selector:"[expr22]"},{redundantAttribute:"expr23",selector:"[expr23]",expressions:[{type:expressionTypes2.ATTRIBUTE,name:"style",evaluate:_scope=>`display: ${_scope.$("#recommendation").value=="?"?"block":"none"}`}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u7C92\u5B50\u7A2E\u6570",bindings:[]}],attributes:[],redundantAttribute:"expr24",selector:"[expr24]"},{redundantAttribute:"expr25",selector:"[expr25]",expressions:[{type:expressionTypes2.VALUE,evaluate:_scope=>_scope.state.nspecies},{type:expressionTypes2.EVENT,name:"onchange",evaluate:_scope=>_scope.editorChanged}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u221A\u7C92\u5B50\u6570",bindings:[]}],attributes:[],redundantAttribute:"expr26",selector:"[expr26]"},{redundantAttribute:"expr27",selector:"[expr27]",expressions:[{type:expressionTypes2.VALUE,evaluate:_scope=>_scope.state.nlattice},{type:expressionTypes2.EVENT,name:"onchange",evaluate:_scope=>_scope.editorChanged}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u30B9\u30B1\u30FC\u30EB",bindings:[]}],attributes:[],redundantAttribute:"expr28",selector:"[expr28]"},{redundantAttribute:"expr29",selector:"[expr29]",expressions:[{type:expressionTypes2.VALUE,evaluate:_scope=>_scope.state.scale},{type:expressionTypes2.EVENT,name:"onchange",evaluate:_scope=>_scope.editorChanged}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u8A08\u7B97\u30B9\u30C6\u30C3\u30D7",bindings:[]}],attributes:[],redundantAttribute:"expr30",selector:"[expr30]"},{redundantAttribute:"expr31",selector:"[expr31]",expressions:[{type:expressionTypes2.VALUE,evaluate:_scope=>_scope.state.step},{type:expressionTypes2.EVENT,name:"onchange",evaluate:_scope=>_scope.editorChanged}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u5C3E\u306E\u9577\u3055",bindings:[]}],attributes:[],redundantAttribute:"expr32",selector:"[expr32]"},{redundantAttribute:"expr33",selector:"[expr33]",expressions:[{type:expressionTypes2.VALUE,evaluate:_scope=>_scope.state.tail},{type:expressionTypes2.EVENT,name:"onchange",evaluate:_scope=>_scope.editorChanged},{type:expressionTypes2.ATTRIBUTE,name:"step",evaluate:_scope=>_scope.state.tail<15?1:_scope.state.tail<30?2:10}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u63FA\u52D5",bindings:[]}],attributes:[],redundantAttribute:"expr34",selector:"[expr34]"},{redundantAttribute:"expr35",selector:"[expr35]",expressions:[{type:expressionTypes2.ATTRIBUTE,name:"checked",evaluate:_scope=>_scope.state.perturb!=0},{type:expressionTypes2.EVENT,name:"onchange",evaluate:_scope=>_scope.editorChanged}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u76F8\u4E92\u4F5C\u7528\u30BB\u30C3\u30C8",bindings:[]}],attributes:[],redundantAttribute:"expr36",selector:"[expr36]"},{redundantAttribute:"expr37",selector:"[expr37]",expressions:[{type:expressionTypes2.VALUE,evaluate:_scope=>_scope.state.intset},{type:expressionTypes2.EVENT,name:"onchange",evaluate:_scope=>_scope.editorChanged}]},{redundantAttribute:"expr38",selector:"[expr38]",expressions:[{type:expressionTypes2.TEXT,childNodeIndex:0,evaluate:_scope=>_scope.i18n.t("\u30C7\u30D5\u30A9\u30EB\u30C8")}]},{redundantAttribute:"expr39",selector:"[expr39]",expressions:[{type:expressionTypes2.TEXT,childNodeIndex:0,evaluate:_scope=>_scope.i18n.t("\u591A\u7C92\u5B50\u7A2E\u88DC\u6B63A")}]},{redundantAttribute:"expr40",selector:"[expr40]",expressions:[{type:expressionTypes2.TEXT,childNodeIndex:0,evaluate:_scope=>_scope.i18n.t("\u591A\u7C92\u5B50\u7A2E\u88DC\u6B63B")}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u76F8\u4E92\u4F5C\u7528\u30B7\u30FC\u30C9",bindings:[]}],attributes:[],redundantAttribute:"expr41",selector:"[expr41]"},{redundantAttribute:"expr42",selector:"[expr42]",expressions:[{type:expressionTypes2.VALUE,evaluate:_scope=>_scope.state.interact_seed},{type:expressionTypes2.EVENT,name:"onchange",evaluate:_scope=>_scope.editorChanged}]},{redundantAttribute:"expr43",selector:"[expr43]",expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>_scope.regenerateInteractionSeed}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"ion-icon",slots:[],attributes:[],redundantAttribute:"expr44",selector:"[expr44]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u7C92\u5B50\u914D\u7F6E\u30B7\u30FC\u30C9",bindings:[]}],attributes:[],redundantAttribute:"expr45",selector:"[expr45]"},{redundantAttribute:"expr46",selector:"[expr46]",expressions:[{type:expressionTypes2.VALUE,evaluate:_scope=>_scope.state.world_seed},{type:expressionTypes2.EVENT,name:"onchange",evaluate:_scope=>_scope.editorChanged}]},{redundantAttribute:"expr47",selector:"[expr47]",expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>_scope.regenerateWorldSeed}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"ion-icon",slots:[],attributes:[],redundantAttribute:"expr48",selector:"[expr48]"},{redundantAttribute:"expr49",selector:"[expr49]",expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>_scope.props.onShowEditor}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u30D1\u30E9\u30E1\u30FC\u30BF\u30A8\u30C7\u30A3\u30BF\u3092\u8868\u793A/\u975E\u8868\u793A",bindings:[]}],attributes:[],redundantAttribute:"expr50",selector:"[expr50]"}]),name:"pl-controls"};var t4={css:`color-scale-editor,[is="color-scale-editor"]{ --ctrl-height: 40px; --ctrl-width: 600px; display: inline-block; width: var(--ctrl-width); max-width: var(--100vw) !important; line-height: 1; } @media screen and (max-width: 640px) { color-scale-editor,[is="color-scale-editor"]{ margin-left: -0.75rem; margin-right: -0.75rem; } } color-scale-editor > div,[is="color-scale-editor"] > div{ max-width: 100%; } color-scale-editor a.button,[is="color-scale-editor"] a.button{ width: var(--ctrl-height); height: var(--ctrl-height); } color-scale-editor .has-canvas,[is="color-scale-editor"] .has-canvas{ width: calc(100% - var(--ctrl-height)); } color-scale-editor canvas,[is="color-scale-editor"] canvas{ width: 100%; height: var(--ctrl-height); margin: 0px; touch-action: none; cursor: all-scroll; }`,exports:{onBeforeMount(props,state){Object.assign(state,{iscale:0,offset:0,scale:1,mouseDown:false});props.intf.update=(...args)=>this.update(...args)},onMounted(props,state){if(props.width)this.root.style.setProperty("--ctrl-width",`${props.width}px`);if(props.height)this.root.style.setProperty("--ctrl-height",`${props.height}px`);const canvas=this.$("canvas");const g=canvas.getContext("2d");g.scale(canvas.width,canvas.height);this.update();this.defineDragBehavior(canvas,{down:(e,x,y)=>{e.preventDefault();this.state.mouseDown=true},move:(e,mouseDown,newX2,newY2,oldX,oldY)=>{if(!mouseDown)return;e.preventDefault();const[dx,dy]=[newX2-oldX,newY2-oldY];this.state.scale/=1+dy/canvas.clientHeight/8;this.state.offset-=dx/canvas.clientWidth/this.state.scale;this.update()},up:(e,x,y)=>{this.update({mouseDown:false})}})},onBeforeUpdate(props,state){if(isNaN(state.iscale))state.iscale=0;state.iscale=(state.iscale+this.props.intf.colorScaleList.length)%this.props.intf.colorScaleList.length;if(isNaN(state.offset))state.offset=0;state.offset-=Math.floor(state.offset);if(isNaN(state.scale))state.scale=1;state.scale=Math.min(17*255/256,Math.max(1,state.scale))},onUpdated(props,state){const scale=this.props.intf.colorScaleList[state.iscale];const factor=1/(1+Math.round((state.scale-1)*16)/16);const offset=Math.round(state.offset*256)/256;state.colorFunc=x=>{x=factor*x+offset;return scale.color(x-Math.floor(x))};this.render();this.dispatchEvent("update",state)},render(){const canvas=this.$("canvas");const g=canvas.getContext("2d");const n=200;for(let i=0;i<n;i++){let x=i/n;g.fillStyle=this.state.colorFunc(x);g.fillRect(x,0,x+1.1/n,1)}}},template:(template,expressionTypes2,bindingTypes2,getComponent)=>template('<div class="field has-addons"><div class="control has-canvas"><canvas></canvas></div><div class="control"><a expr113="expr113" class="button"><span class="icon is-small"><ion-icon expr114="expr114" name="swap-vertical"></ion-icon></span></a></div></div>',[{redundantAttribute:"expr113",selector:"[expr113]",expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>()=>_scope.update({iscale:_scope.state.iscale+1})}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"ion-icon",slots:[],attributes:[],redundantAttribute:"expr114",selector:"[expr114]"}]),name:"color-scale-editor"};var t5={css:`interaction-editor .slider-label,[is="interaction-editor"] .slider-label{ padding-left: 2rem; display: inline-block; width: 150px; height: 2rem; } interaction-editor .slider,[is="interaction-editor"] .slider{ width: 400px; } interaction-editor .is-clickable *,[is="interaction-editor"] .is-clickable *{ touch-action: none; pointer-events: none; } interaction-editor .collapsed + .message-body,[is="interaction-editor"] .collapsed + .message-body{ display: none; } interaction-editor .container,[is="interaction-editor"] .container{ position: relative; line-height: 100%; margin: 0px; padding: 0px; max-width: 90vw; margin-bottom: 40px; } interaction-editor canvas,[is="interaction-editor"] canvas{ z-index: 0; margin: 0px; padding: 0px; touch-action: none; max-width: 90vw; } interaction-editor #scale-text,[is="interaction-editor"] #scale-text{ text-align: center; color: white; padding-top: 10px; z-index: 1; position: relative; } interaction-editor #scale,[is="interaction-editor"] #scale{ position: absolute; max-width: 90vw; } interaction-editor .arrow,[is="interaction-editor"] .arrow{ --value: 0px; position: absolute; left: calc(var(--value) - 5px); width: 0; height: 0; border-bottom: 8px solid white; border-right: 5px transparent solid; border-left: 5px transparent solid; } interaction-editor .arrow.overflow,[is="interaction-editor"] .arrow.overflow{ border-bottom-color: red; } interaction-editor #cursor,[is="interaction-editor"] #cursor{ position: absolute; border: #c6c solid 4px; pointer-events: none; }`,exports:{onBeforeMount(props,state){Object.assign(state,{current_ij:false,world:null,colorFunc:null});props.intf.update=(...args)=>this.update(...args)},onMounted(props,state){this.setupViewerEvents()},setupViewerEvents(){const viewer=this.$("#matrix");const e2ij=e=>{if(!this.state.world)return null;const n=this.state.world.nspecies;const crect=viewer.getBoundingClientRect();const ij=[Math.floor((e.clientY-crect.top)/crect.height*(n+1))-1,Math.floor((e.clientX-crect.left)/crect.width*(n+1))-1];if(ij[0]<0||ij[0]>=n||ij[1]<0||ij[1]>=n){return null}return ij};let dragging=null;this.defineDragBehavior(viewer,{down:(e,x,y)=>{e.preventDefault();dragging=e2ij(e);this.update({current_ij:dragging})},move:(e,mouseDown,newX2,newY2,oldX,oldY)=>{if(dragging==null){this.update({current_ij:e2ij(e)});return}e.preventDefault();const dx=newX2-oldX;const dy=newY2-oldY;[a,b]=this.state.world.interaction.get(...dragging);a+=dy*25e-7;if(a>=-5e-4)a=-5e-4;b-=dx*25e-7;this.state.world.interaction.set(...dragging,a,b);this.update({current_ij:dragging})},up:(e,x,y)=>{dragging=null;this.update({current_ij:e2ij(e)})}});viewer.addEventListener("pointerleave",e=>{if(!dragging)this.update({current_ij:null})})},getScaleText(){if(!this.state.current_ij)return"";const[i,j]=this.state.current_ij;const[a2,b2]=this.state.world.interaction.get(i,j);return i18n.tag`#${i+1}  #${j+1}  ( ${Math.round(-a2/.0015*100)/100},  ${Math.round(-b2/5e-4*100)/100})`},onUpdated(props,state){this.render_matrix();this.render_scale();if(this.state.current_ij){const[i,j]=this.state.current_ij;const[a2,b2]=this.state.world.interaction.get(i,j);const w=this.$("#matrix").clientWidth;const oy=this.$("#matrix").offsetTop;const ax=Math.round(-a2/.0015*w/2+w/2);this.$("#a").style.setProperty("--value",Math.min(w,Math.max(0,ax))+"px");this.$("#a").classList.toggle("overflow",ax<0||w<ax);this.$("#a").style.top=w+oy+"px";const bx=Math.round(-b2/5e-4*w/2+w/2);this.$("#b").style.setProperty("--value",Math.min(w,Math.max(0,bx))+"px");this.$("#b").classList.toggle("overflow",bx<0||w<bx);this.$("#b").style.top=w+oy+"px";const n=this.state.world.nspecies;Object.assign(this.$("#cursor").style,{left:w*(1+j)/(n+1)+w/(n+1)*.1+"px",top:w*(1+i)/(n+1)+w/(n+1)*.1+oy+"px",width:w/(n+1)*.9+"px",height:w/(n+1)*.9+"px"})}},onRadiusSliderChange(e){let{id,value}=e.target;const d=.005;const world=this.state.world;const{rth1,rth2,rmax,decel}=world;if(id=="rth1")value=Math.min(rth2-d,Math.max(0,value));if(id=="rth2")value=Math.min(rmax-d,Math.max(rth1+d,value));if(id=="rmax")value=Math.min(.4,Math.max(rth2+d,value));if(id=="decel")value=Math.min(1,Math.max(0,value));if(id=="perturb")value=Math.min(10,Math.max(0,value))/1e3;world[id]=value;world.interaction.convertAll();world.update(world);this.update()},render_matrix(){if(!this.state.world||!this.state.colorFunc)return;if(this.state.world.recreating)return;const n=this.state.world.nspecies;const canvas=this.$("#matrix");const g=canvas.getContext("2d");const palette=[...Array(n)].map((_,i)=>this.state.colorFunc(i/n));const dist=new PLSpeciesDistribution(n,this.state.world.particles);const dist_max=Math.max(...dist.distribution)*1.2;g.setTransform(1,0,0,1,0,0);g.scale(canvas.width/(n+1),canvas.height/(n+1));g.fillStyle="#fff";g.fillRect(0,0,n+1,n+1);for(let i=0;i<n;i++){g.beginPath();g.fillStyle=palette[i];g.arc(.3,1.5+i,.3,0,2*Math.PI);g.fill();g.beginPath();g.fillStyle=palette[i];g.arc(1.5+i,.5,.3,0,2*Math.PI);g.fill();g.fillStyle="#3c3";g.fillRect(.7,1.1+i+(1-dist.distribution[i]/dist_max)*.9,.2,dist.distribution[i]/dist_max*.9);const color=this.props.intf.intColorFunc;for(let j=0;j<n;j++){let[a2,b2]=this.state.world.interaction.get(i,j);if(!isNaN(b2)){g.fillStyle=color((-b2/5e-4+1)/2);g.fillRect(1.1+j,1.1+i,.9,.9)}if(!isNaN(a2)){g.fillStyle=color((-a2/.0015+1)/2);g.fillRect(1.1+j,1.1+i,.5,.5)}}}},render_scale(){const color=this.props.intf.intColorFunc;const canvas=this.$("#scale");const g=canvas.getContext("2d");g.setTransform(1,0,0,1,0,0);g.scale(canvas.width,canvas.height);for(let i=0;i<200;i++){g.fillStyle=color(i/200);g.fillRect(i/200,0,1/200+.01,1)}},collapsePanel(e){e.target.classList.toggle("collapsed")}},template:(template,expressionTypes2,bindingTypes2,getComponent)=>template('<section expr51="expr51" class="message is-info"><div expr52="expr52" class="message-header is-clickable"><i18n expr53="expr53"></i18n><span><ion-icon expr54="expr54" name="chevron-up"></ion-icon><ion-icon expr55="expr55" name="chevron-down"></ion-icon></span></div><div class="message-body container"><canvas expr56="expr56" id="matrix"></canvas><br/><canvas expr57="expr57" id="scale" height="40"></canvas><div expr58="expr58" id="a" class="arrow"></div><div expr59="expr59" id="b" class="arrow"></div><div expr60="expr60" id="scale-text"> </div><div expr61="expr61" id="cursor"></div><br/><div class="content"><ul><li><i18n expr62="expr62"></i18n></li><li><i18n expr63="expr63"></i18n></li><li><i18n expr64="expr64"></i18n></li><li><i18n expr65="expr65"></i18n></li><li><i18n expr66="expr66"></i18n></li></ul><br/></div></div></section><section expr67="expr67" class="container message is-info"><div expr68="expr68" class="message-header is-clickable"><i18n expr69="expr69"></i18n><span><ion-icon expr70="expr70" name="chevron-up"></ion-icon><ion-icon expr71="expr71" name="chevron-down"></ion-icon></span></div><div class="message-body container"><div class="content"><div style="padding-left:10px;padding-top:20px;"><input expr72="expr72" class="slider" id="rth1" step="0.001" min="0" max="0.4" type="range"/><label expr73="expr73" for="rth1" class="slider-label"><span>Rth1 </span> </label><br/><input expr74="expr74" class="slider" id="rth2" step="0.001" min="0" max="0.4" type="range"/><label expr75="expr75" for="rth2" class="slider-label"><span>Rth2 </span> </label><br/><input expr76="expr76" class="slider" id="rmax" step="0.001" min="0" max="0.4" type="range"/><label expr77="expr77" for="rmax" class="slider-label"><span>Rmax </span> </label><br/><input expr78="expr78" class="slider" id="decel" step="0.001" min="0" max="1" type="range"/><label expr79="expr79" for="decel" class="slider-label"><span>Decel </span> </label><br/><input expr80="expr80" class="slider" id="perturb" step="0.01" min="0" max="10" type="range"/><label expr81="expr81" for="perturb" class="slider-label"><span>Perturb </span> </label><br/><input expr82="expr82" class="slider" id="row_div" step="1" min="1" max="10" type="range"/><label expr83="expr83" for="row_div" class="slider-label"><span>RowDiv </span> </label><br/><div class="columns"><div class="column is-narrow field"><label for="canvas-mode" class="label"><span>Canvas Rendering Mode</span></label><div class="select"><select id="canvas-mode" value="webgl"><option value="webgl">WebGL</option><option value="screen">2D (screen)</option><option value="sourceOver">2D (source-over)</option></select></div></div><div class="column is-narrow field"><label for="max-fps" class="label"><i18n expr84="expr84"></i18n></label><div class="control"><input expr85="expr85" class="input" id="max-fps" inputmode="decimal" value="61" size="3" min="0" max="1000" step="10"/></div></div></div></div><ul><li><i18n expr86="expr86" id="\u8FD1\u8DDD\u96E2\u65A5\u529B\u8AAC\u660E"></i18n></li><li><i18n expr87="expr87" id="\u9060\u8DDD\u96E2\u529B\u8AAC\u660E"></i18n></li><li><i18n expr88="expr88" id="\u6E1B\u8870\u91CF\u8AAC\u660E"></i18n></li><li><i18n expr89="expr89" id="\u63FA\u52D5\u8AAC\u660E"></i18n></li><li><i18n expr90="expr90" id="rowdiv\u8AAC\u660E"></i18n></li><li><i18n expr91="expr91" id="canvasMode\u8AAC\u660E"></i18n></li></ul><br/></div></div></section>',[{redundantAttribute:"expr51",selector:"[expr51]",expressions:[{type:expressionTypes2.ATTRIBUTE,name:"style",evaluate:_scope=>`width:${Number(_scope.props.width)+2}px`}]},{redundantAttribute:"expr52",selector:"[expr52]",expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>_scope.collapsePanel}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u76F8\u4E92\u4F5C\u7528\u4FC2\u6570\u30DE\u30C8\u30EA\u30AF\u30B9",bindings:[]}],attributes:[],redundantAttribute:"expr53",selector:"[expr53]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"ion-icon",slots:[],attributes:[],redundantAttribute:"expr54",selector:"[expr54]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"ion-icon",slots:[],attributes:[],redundantAttribute:"expr55",selector:"[expr55]"},{redundantAttribute:"expr56",selector:"[expr56]",expressions:[{type:expressionTypes2.ATTRIBUTE,name:"width",evaluate:_scope=>_scope.props.width},{type:expressionTypes2.ATTRIBUTE,name:"height",evaluate:_scope=>_scope.props.width}]},{redundantAttribute:"expr57",selector:"[expr57]",expressions:[{type:expressionTypes2.ATTRIBUTE,name:"width",evaluate:_scope=>_scope.props.width}]},{redundantAttribute:"expr58",selector:"[expr58]",expressions:[{type:expressionTypes2.ATTRIBUTE,name:"style",evaluate:_scope=>"visibility:"+(_scope.state.current_ij?"visible":"hidden")}]},{redundantAttribute:"expr59",selector:"[expr59]",expressions:[{type:expressionTypes2.ATTRIBUTE,name:"style",evaluate:_scope=>"visibility:"+(_scope.state.current_ij?"visible":"hidden")}]},{redundantAttribute:"expr60",selector:"[expr60]",expressions:[{type:expressionTypes2.TEXT,childNodeIndex:0,evaluate:_scope=>[_scope.getScaleText(),"\xA0"].join("")},{type:expressionTypes2.ATTRIBUTE,name:"style",evaluate:_scope=>"visibility:"+(_scope.state.current_ij?"visible":"hidden")}]},{redundantAttribute:"expr61",selector:"[expr61]",expressions:[{type:expressionTypes2.ATTRIBUTE,name:"style",evaluate:_scope=>"visibility:"+(_scope.state.current_ij?"visible":"hidden")}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u76F8\u4E92\u4F5C\u7528\u306F\u975E\u5BFE\u79F0\u3067 a \u304C b \u304B\u3089\u53D7\u3051\u308B\u529B\u3068 b \u304C a \u304B\u3089\u53D7\u3051\u308B\u529B\u306F\u7570\u306A\u308B",bindings:[]}],attributes:[],redundantAttribute:"expr62",selector:"[expr62]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u5F15\u529B\u306F\u8CA0\u3067\u9752\u3001\u65A5\u529B\u306F\u6B63\u3067\u8D64",bindings:[]}],attributes:[],redundantAttribute:"expr63",selector:"[expr63]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u8FD1\u8DDD\u96E2\u529B\uFF08\u7C92\u5B50\u304C\u6975\u7AEF\u306B\u8FD1\u3065\u3044\u305F\u6642\u306E\u529B\uFF09\u306F\u5E38\u306B\u65A5\u529B",bindings:[]}],attributes:[],redundantAttribute:"expr64",selector:"[expr64]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u9060\u8DDD\u96E2\u529B\u306F\u5F15\u529B\u306B\u3082\u65A5\u529B\u306B\u3082\u306A\u308B",bindings:[]}],attributes:[],redundantAttribute:"expr65",selector:"[expr65]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u5B9F\u969B\u306B\u639B\u304B\u308B\u529B\u306F\u3053\u3053\u3067\u6307\u5B9A\u3057\u305F\u4FC2\u6570\u3092\u8DDD\u96E2\u306B\u5FDC\u3058\u3066\u6E1B\u8870\u3055\u305B\u305F\u5024\u306B\u306A\u308B",bindings:[]}],attributes:[],redundantAttribute:"expr66",selector:"[expr66]"},{redundantAttribute:"expr67",selector:"[expr67]",expressions:[{type:expressionTypes2.ATTRIBUTE,name:"style",evaluate:_scope=>`width:${Number(_scope.props.width)+2}px`}]},{redundantAttribute:"expr68",selector:"[expr68]",expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>_scope.collapsePanel}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u76F8\u4E92\u4F5C\u7528\u8DDD\u96E2\u30FB\u6E1B\u8870\u30FB\u63FA\u52D5",bindings:[]}],attributes:[],redundantAttribute:"expr69",selector:"[expr69]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"ion-icon",slots:[],attributes:[],redundantAttribute:"expr70",selector:"[expr70]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"ion-icon",slots:[],attributes:[],redundantAttribute:"expr71",selector:"[expr71]"},{redundantAttribute:"expr72",selector:"[expr72]",expressions:[{type:expressionTypes2.VALUE,evaluate:_scope=>_scope.state.world&&_scope.state.world.rth1},{type:expressionTypes2.EVENT,name:"oninput",evaluate:_scope=>_scope.onRadiusSliderChange}]},{redundantAttribute:"expr73",selector:"[expr73]",expressions:[{type:expressionTypes2.TEXT,childNodeIndex:1,evaluate:_scope=>["= ",_scope.state.world&&_scope.state.world.rth1].join("")}]},{redundantAttribute:"expr74",selector:"[expr74]",expressions:[{type:expressionTypes2.VALUE,evaluate:_scope=>_scope.state.world&&_scope.state.world.rth2},{type:expressionTypes2.EVENT,name:"oninput",evaluate:_scope=>_scope.onRadiusSliderChange}]},{redundantAttribute:"expr75",selector:"[expr75]",expressions:[{type:expressionTypes2.TEXT,childNodeIndex:1,evaluate:_scope=>["= ",_scope.state.world&&_scope.state.world.rth2].join("")}]},{redundantAttribute:"expr76",selector:"[expr76]",expressions:[{type:expressionTypes2.VALUE,evaluate:_scope=>_scope.state.world&&_scope.state.world.rmax},{type:expressionTypes2.EVENT,name:"oninput",evaluate:_scope=>_scope.onRadiusSliderChange}]},{redundantAttribute:"expr77",selector:"[expr77]",expressions:[{type:expressionTypes2.TEXT,childNodeIndex:1,evaluate:_scope=>["= ",_scope.state.world&&_scope.state.world.rmax].join("")}]},{redundantAttribute:"expr78",selector:"[expr78]",expressions:[{type:expressionTypes2.VALUE,evaluate:_scope=>_scope.state.world&&_scope.state.world.decel},{type:expressionTypes2.EVENT,name:"oninput",evaluate:_scope=>_scope.onRadiusSliderChange}]},{redundantAttribute:"expr79",selector:"[expr79]",expressions:[{type:expressionTypes2.TEXT,childNodeIndex:1,evaluate:_scope=>["= ",_scope.state.world&&_scope.state.world.decel].join("")}]},{redundantAttribute:"expr80",selector:"[expr80]",expressions:[{type:expressionTypes2.VALUE,evaluate:_scope=>_scope.state.world&&_scope.state.world.perturb*1e3},{type:expressionTypes2.EVENT,name:"oninput",evaluate:_scope=>_scope.onRadiusSliderChange}]},{redundantAttribute:"expr81",selector:"[expr81]",expressions:[{type:expressionTypes2.TEXT,childNodeIndex:1,evaluate:_scope=>["= ",_scope.state.world&&_scope.state.world.perturb*1e3].join("")}]},{redundantAttribute:"expr82",selector:"[expr82]",expressions:[{type:expressionTypes2.VALUE,evaluate:_scope=>_scope.state.world&&_scope.state.world.row_div},{type:expressionTypes2.EVENT,name:"oninput",evaluate:_scope=>_scope.onRadiusSliderChange}]},{redundantAttribute:"expr83",selector:"[expr83]",expressions:[{type:expressionTypes2.TEXT,childNodeIndex:1,evaluate:_scope=>["= ",_scope.state.world&&_scope.state.world.row_div].join("")}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u6700\u5927fps",bindings:[]}],attributes:[],redundantAttribute:"expr84",selector:"[expr84]"},{redundantAttribute:"expr85",selector:"[expr85]",expressions:[{type:expressionTypes2.EVENT,name:"onchange",evaluate:_scope=>_scope.props.onMaxFpsChange}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u8FD1\u8DDD\u96E2\u65A5\u529B\u306F r = 0 \u3067\u6307\u5B9A\u5024\u3001r = Rth1 \u307E\u3067\u7DDA\u578B\u306B\u6E1B\u5C11",bindings:[]}],attributes:[],redundantAttribute:"expr86",selector:"[expr86]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u9060\u8DDD\u96E2\u529B\u306F r = Rth2 \u3067\u6307\u5B9A\u5024\u3001r = Rth1 \u304A\u3088\u3073 r = Rmax \u307E\u3067\u7DDA\u578B\u306B\u6E1B\u5C11",bindings:[]}],attributes:[],redundantAttribute:"expr87",selector:"[expr87]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u7C92\u5B50\u901F\u5EA6\u306F\u8A08\u7B97\u30B9\u30C6\u30C3\u30D7\u3054\u3068\u306B decel \u56E0\u5B50\u3092\u639B\u3051\u308B\u3053\u3068\u3067\u6E1B\u8870\u3055\u308C\u308B",bindings:[]}],attributes:[],redundantAttribute:"expr88",selector:"[expr88]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u8A08\u7B97\u30B9\u30C6\u30C3\u30D7\u3054\u3068\u306B Perturb \u306E \xB1 1/2,000 \u3092\u6700\u5927\u5024\u3068\u3059\u308B\u4E71\u6570\u304C\u901F\u5EA6\u306B\u52A0\u7B97\u3055\u308C\u308B\u3002",bindings:[]}],attributes:[],redundantAttribute:"expr89",selector:"[expr89]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u76F8\u4E92\u4F5C\u7528\u8A08\u7B97\u306E\u6700\u9069\u5316\u30D1\u30E9\u30E1\u30FC\u30BF\u3002\uFF13\uFF5E\uFF14\u3042\u305F\u308A\u3067\u6700\u3082\u9AD8\u901F\u3002\u8A08\u7B97\u7D50\u679C\u306B\u306F\u5F71\u97FF\u3057\u306A\u3044\u306F\u305A\u3002",bindings:[]}],attributes:[],redundantAttribute:"expr90",selector:"[expr90]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"WebGL \u306E\u4F7F\u3048\u306A\u3044\u74B0\u5883\u3067\u306F Firefox \u7CFB\u3067\u63CF\u753B\u304C\u975E\u5E38\u306B\u91CD\u304F\u306A\u308B\u3002Canvas Rendering Mode \u3067 2D (source-over) \u3092\u9078\u3076\u3068\u54C1\u8CEA\u3092\u72A0\u7272\u306B\u901F\u5EA6\u304C\u5F97\u3089\u308C\u308B\u3002",bindings:[]}],attributes:[],redundantAttribute:"expr91",selector:"[expr91]"}]),name:"interaction-editor"};var helpContents=[[`\u7C92\u5B50\u306B\u547D\u304C\u5BBF\u308B\u4E16\u754C\u3092\u306E\u3093\u3073\u308A\u773A\u3081\u306A\u304C\u3089\u6E21\u308A\u6B69\u304F\u30B5\u30A4\u30C8\u3067\u3059<br>
    <br>
    \u98FD\u304D\u305F\u3089 [\u6B21\u306E\u30EF\u30FC\u30EB\u30C9\u3092\u751F\u6210] \u3092\u62BC\u3059\u3068\u7570\u306A\u308B\u4E16\u754C\u306B\u79FB\u308C\u307E\u3059`,"new-world"],[`[\u30EF\u30FC\u30EB\u30C9\u8A2D\u5B9A] \u3067\u304A\u52E7\u3081\u306E\u8A2D\u5B9A\u3092\u9078\u3093\u3060\u3089\u4F55\u5EA6\u304B\u62BC\u3057\u3066\u307F\u3066\u304F\u3060\u3055\u3044`,"recommendation"],[`[\u5168\u753B\u9762  <span class="icon"><ion-icon name="expand"></ion-icon></span>]
    \u3092\u62BC\u3059\u3068\u30D5\u30EB\u30B9\u30AF\u30EA\u30FC\u30F3\u8868\u793A\u306B\u3067\u304D\u307E\u3059<br><br>
    \u30D5\u30EB\u30B9\u30AF\u30EA\u30FC\u30F3\u8868\u793A\u4E2D\u306F\u7BC4\u56F2\u5916\u306E\u30C0\u30D6\u30EB\u30AF\u30EA\u30C3\u30AF/\u30BF\u30C3\u30D7\u3042\u308B\u3044\u306F N \u30AD\u30FC\u3067\u6B21\u306E\u30EF\u30FC\u30EB\u30C9\u3078\u79FB\u308C\u307E\u3059`,"full-screen"],[`\u30E1\u30A4\u30F3\u753B\u9762\u306E\u30C0\u30D6\u30EB\u30AF\u30EA\u30C3\u30AF/\u30BF\u30C3\u30D7\u3067\u30EF\u30FC\u30EB\u30C9\u306B\u6307\u3092\u7A81\u3063\u8FBC\u3081\u307E\u3059`,"particles-display"],['[\u3053\u306E\u30EF\u30FC\u30EB\u30C9\u3092\u30B7\u30A7\u30A2&nbsp; <span class="icon"><ion-icon name="share-social"></ion-icon></span></a>] \u3067\u4ECA\u3044\u308B\u30EF\u30FC\u30EB\u30C9\u3078\u306E\u30EA\u30F3\u30AF\u3092\u30AF\u30EA\u30C3\u30D7\u30DC\u30FC\u30C9\u3078\u30B3\u30D4\u30FC\u3067\u304D\u307E\u3059',"copy-url"],[`[\u63CF\u753B\u5236\u5FA1] \u306E 
    <span class="icon is-small"><ion-icon name="color-palette"></ion-icon></span> 
    \u3067\u73FE\u308C\u308B\u30AB\u30E9\u30FC\u30B9\u30B1\u30FC\u30EB\u3092\u4E0A\u4E0B\u5DE6\u53F3\u306B\u3044\u3058\u308B\u3068\u914D\u8272\u3092\u5909\u3048\u3089\u308C\u307E\u3059`,"palette"],[`[\u63CF\u753B\u5236\u5FA1] \u306E 
    <span class="icon is-small"><ion-icon name="play-skip-back"></ion-icon></span> 
    \u3067\u73FE\u5728\u306E\u30EF\u30FC\u30EB\u30C9\u3092\u306F\u3058\u3081\u304B\u3089\u30EA\u30D7\u30EC\u30A4\u3067\u304D\u307E\u3059<br>
    <br>
    \u305D\u308C\u3067\u306F\u3069\u3046\u305E\u306E\u3093\u3073\u308A\u304A\u697D\u3057\u307F\u304F\u3060\u3055\u3044`,"replay"]];var t6={css:`help-popup .background,[is="help-popup"] .background{ display: none; } help-popup #help-popup,[is="help-popup"] #help-popup{ display: none; } help-popup.shown .background,[is="help-popup"].shown .background{ display: block; } help-popup.shown #help-popup,[is="help-popup"].shown #help-popup{ display: block; } help-popup .buttons,[is="help-popup"] .buttons{ display: flex; justify-content: flex-end; } help-popup .progress,[is="help-popup"] .progress{ margin-top: 5px; } help-popup .background,[is="help-popup"] .background{ position: fixed; background-color: rgba(0, 0, 0, 0.3137254902); z-index: 10; top: 0px; left: 0px; width: 100vw; height: 100vh; } help-popup #help-popup,[is="help-popup"] #help-popup{ z-index: 15; position: absolute; left: 5vw; width: 550px; max-width: calc(var(--100vw) - 10vw); top: 160px; } help-popup #help-text,[is="help-popup"] #help-text{ line-height: 1.5; min-height: 8em; } help-popup #next-button,[is="help-popup"] #next-button{ margin: 5px 0px; } help-popup .arrow,[is="help-popup"] .arrow{ position: absolute; display: block; text-decoration: none; font-size: 24px; box-sizing: border-box; color: white; padding: 5px; border-radius: 3px; background-color: #9c0; font-weight: bold; z-index: 10; margin-top: -10px; } help-popup .arrow::after,[is="help-popup"] .arrow::after{ display: block; position: absolute; width: 20px; height: 20px; margin: 0 10px; border-bottom: 15px solid #9c0; border-right: 15px solid #9c0; transform: rotate(45deg); top: 35px; left: 10px; content: ""; }`,exports:{onBeforeMount(props,state){this.i18n=i18n;this.onBeforeUpdate(props,state)},onMounted(){i18n.addEventListener("update",this.onI18nUpdate)},onUnmounted(){i18n.removeEventListener("update",this.onI18nUpdate)},onI18nUpdate(){this.update()},onBeforeUpdate(props,state){props.intf.show=()=>this.show();if(state.messages!=helpContents){state.messages=helpContents;state.n=helpContents.length;state.i=0}if(state.i>=state.n)this.close();if(state.i<0)state.i=0;this.messages=[];state.messages.forEach(message=>i18n.t(message[0],message[1]+"_help").split(/<br>[\s\n]*<br>/).forEach(message2=>{this.messages.push(message2)}))},show(){if(this.root.classList.contains("shown"))return;const scrollTo=document.querySelector("app").getBoundingClientRect().top;window.scrollTo(0,scrollTo+window.scrollY);document.addEventListener("keydown",this.keydown);this.root.classList.add("shown");this.state.i=0;this.update()},close(){document.removeEventListener("keydown",this.keydown);this.root.classList.remove("shown")},keydown(e){if(e.key==="Escape"){this.close()}if(e.key==="Enter"||e.key===" "||e.key==="ArrowRight"){e.preventDefault();this.state.i+=1;this.update()}if(e.key==="ArrowLeft"){e.preventDefault();this.state.i-=1;this.update()}},onUpdated(props,state){const arrow=this.$(".arrow");const targetId=state.messages[state.i][1];if(!targetId){arrow.style.display="none";return}let target=document.getElementById(targetId);if(target){let targetRect=target.getBoundingClientRect();let targetTop=targetRect.top-50;let targetLeft=targetRect.left+targetRect.width/2-30;let arrowRect=arrow.getBoundingClientRect();arrow.style.display="block";arrow.style.top=targetTop+arrow.offsetTop-arrowRect.top+"px";arrow.style.left=targetLeft+arrow.offsetLeft-arrowRect.left+"px";this.blinkElement(arrow)}else{this.cancelBlinkElement();arrow.style.display="none"}},cancelBlinkElement:()=>0,async blinkElement(elem,display="block"){this.cancelBlinkElement();let cancelRequested=false;this.cancelBlinkElement=()=>{cancelRequested=true;elem.style.display=display};for(let i=0;i<8;i++){elem.style.display="none";await util.sleep(200);if(cancelRequested)break;elem.style.display=display;await util.sleep(600);if(cancelRequested)break}}},template:(template,expressionTypes2,bindingTypes2,getComponent)=>template('<div><div expr116="expr116" class="background"></div><article class="message is-info" id="help-popup"><div class="message-header"><i18n expr117="expr117"></i18n><button expr118="expr118" class="delete"></button></div><div class="message-body"><p id="help-text"><raw expr119="expr119"></raw></p><div class="arrow arrow-lb"><i18n expr120="expr120"></i18n></div><div class="buttons"><button expr121="expr121" class="button" id="help-prev"></button><button expr123="expr123" class="button is-info" id="help-next"><i18n expr124="expr124"></i18n></button></div><progress expr125="expr125" class="progress is-link" id="help-progress"> </progress></div></article></div><slot expr126="expr126"></slot>',[{redundantAttribute:"expr116",selector:"[expr116]",expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>_scope.close}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u4F7F\u3044\u65B9",bindings:[]}],attributes:[],redundantAttribute:"expr117",selector:"[expr117]"},{redundantAttribute:"expr118",selector:"[expr118]",expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>_scope.close}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"raw",slots:[],attributes:[{type:expressionTypes2.ATTRIBUTE,name:"html",evaluate:_scope=>_scope.i18n.t(_scope.state.messages[_scope.state.i][0],_scope.state.messages[_scope.state.i][1]+"_help")}],redundantAttribute:"expr119",selector:"[expr119]"},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u3053\u3053\uFF01",bindings:[]}],attributes:[],redundantAttribute:"expr120",selector:"[expr120]"},{type:bindingTypes2.IF,evaluate:_scope=>_scope.state.i!=0,redundantAttribute:"expr121",selector:"[expr121]",template:template('<i18n expr122="expr122"></i18n>',[{expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>()=>_scope.update({"i":_scope.state.i-1})}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:"\u524D\u3078",bindings:[]}],attributes:[],redundantAttribute:"expr122",selector:"[expr122]"}])},{redundantAttribute:"expr123",selector:"[expr123]",expressions:[{type:expressionTypes2.EVENT,name:"onclick",evaluate:_scope=>()=>_scope.update({"i":_scope.state.i+1})}]},{type:bindingTypes2.TAG,getComponent,evaluate:_scope=>"i18n",slots:[{id:"default",html:" ",bindings:[{expressions:[{type:expressionTypes2.TEXT,childNodeIndex:0,evaluate:_scope=>[_scope.state.i==_scope.state.n-1?"\u9589\u3058\u308B":"\u6B21\u3078"].join("")}]}]}],attributes:[],redundantAttribute:"expr124",selector:"[expr124]"},{redundantAttribute:"expr125",selector:"[expr125]",expressions:[{type:expressionTypes2.TEXT,childNodeIndex:0,evaluate:_scope=>[Math.round(_scope.state.i/_scope.state.n*100)," %"].join("")},{type:expressionTypes2.ATTRIBUTE,name:"value",evaluate:_scope=>_scope.state.i+1},{type:expressionTypes2.ATTRIBUTE,name:"max",evaluate:_scope=>_scope.state.n}]},{type:bindingTypes2.SLOT,attributes:[{type:expressionTypes2.ATTRIBUTE,name:"messages",evaluate:_scope=>_scope.messages}],name:"default",redundantAttribute:"expr126",selector:"[expr126]"}]),name:"help-popup"};var t7={css:null,exports:{onUpdated(props,state){if(!this.props.dataBlob)return;const vid=this.$("video");vid.src=URL.createObjectURL(this.props.dataBlob);vid.controls=true;const a2=this.$("a");a2.download=this.props.dataName.substr(1)+".webm";a2.href=vid.src;setTimeout(()=>{this.root.scrollIntoView()},100)}},template:(template,expressionTypes2,bindingTypes2,getComponent)=>template('<div expr115="expr115" class="video-holder"></div>',[{type:bindingTypes2.IF,evaluate:_scope=>_scope.props.dataBlob,redundantAttribute:"expr115",selector:"[expr115]",template:template("<video></video><p><a>download the video</a></p>",[])}]),name:"video-holder"};var t8={css:`i18n .original,[is="i18n"] .original{ display: none; }`,exports:{onMounted(){i18n.addEventListener("update",this.onI18nUpdate);this.update()},onUpdated(){this.$(".translated").innerHTML=i18n.t(this.$(".original").innerHTML,this.props.id)},onUnmounted(){i18n.removeEventListener("update",this.onI18nUpdate)},onI18nUpdate(){this.update()}},template:(template,expressionTypes2,bindingTypes2,getComponent)=>template('<span><span class="original"><slot expr127="expr127"></slot></span><span class="translated"></span></span>',[{type:bindingTypes2.SLOT,attributes:[],name:"default",redundantAttribute:"expr127",selector:"[expr127]"}]),name:"i18n"};function registerAllTags(riot){installPlugins(riot);let tags=[t0,t1,t2,t3,t4,t5,t6,t7,t8];for(let tag of tags)riot.register(tag.name,tag);return tags}function installPlugins(riot){riot.install(component2=>{component2.styleAttribute=attributes=>{return Object.entries(attributes).reduce((acc,item)=>{const[key,value]=item;return[...acc,`${key}: ${value}`]},[]).join(";")};return component2});riot.install(component2=>{component2.defineDragBehavior=(ctrl,handlers)=>{let mouseDown=false;let mouseX,mouseY;ctrl.addEventListener("pointerdown",e=>{if(!isNaN(e.pointerId))ctrl.setPointerCapture(e.pointerId);let crect=ctrl.getBoundingClientRect();[mouseX,mouseY]=[e.clientX-crect.left|0,e.clientY-crect.top|0];mouseDown=true;if(handlers.down)handlers.down(e,mouseX,mouseY)});ctrl.addEventListener("pointermove",e=>{let crect=ctrl.getBoundingClientRect();[newX,newY]=[e.clientX-crect.left|0,e.clientY-crect.top|0];if(handlers.move)handlers.move(e,mouseDown,newX,newY,mouseX,mouseY);[mouseX,mouseY]=[newX,newY]});ctrl.addEventListener("pointerup",e=>{e.preventDefault();if(!isNaN(e.pointerId))ctrl.releasePointerCapture(e.pointerId);mouseDown=false;if(handlers.up)handlers.up(e,mouseX,mouseY)})};return component2});riot.install(component2=>{component2.camelCase=str=>{return str.split("-").map((w,i)=>i===0?w.toLowerCase():w.charAt(0).toUpperCase()+w.slice(1).toLowerCase()).join("")};component2.kebabCase=str=>{return str.split(/(?=[A-Z])/).join("-").toLowerCase()};component2.dispatchEvent=(name,data)=>{const handler=component2.props[component2.camelCase("on-"+name)];if(!handler)return;handler(new CustomEvent("name",{detail:data}))};return component2})}async function main(){let wasm2=await loadWasm("particle-life.wasm");window.wasm=wasm2;window.util=util_exports;window.PLSpeciesDistribution=PLSpeciesDistribution2;window.i18n=i18n2;i18n2.setDictionary("ja",i18n_dictionary_default);registerAllTags(riot_exports);const measureWindowSize=()=>document.body.style.setProperty("--100vw",`${document.body.clientWidth}px`);window.addEventListener("resize",measureWindowSize);measureWindowSize();document.getElementById("locale-en").addEventListener("click",()=>{i18n2.setLocale("en")});document.getElementById("locale-ja").addEventListener("click",()=>{i18n2.setLocale("ja")});mount("app",{recommendations:recommendations_default})}window.addEventListener("load",()=>{main()});})();
/* https://github.com/osamutake/particle-life, @license MIT */
/*! Bundled license information:

@riotjs/util/constants.js:
  (* Riot WIP, @license MIT *)

@riotjs/util/expression-types.js:
  (* Riot WIP, @license MIT *)

@riotjs/util/strings.js:
  (* Riot WIP, @license MIT *)

@riotjs/util/misc.js:
  (* Riot WIP, @license MIT *)

@riotjs/util/checks.js:
  (* Riot WIP, @license MIT *)

@riotjs/util/functions.js:
  (* Riot WIP, @license MIT *)

riot/esm/core/pure-component-api.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/core/mocked-template-interface.js:
  (* Riot v7.1.0, @license MIT *)

@riotjs/util/dom.js:
  (* Riot WIP, @license MIT *)

@riotjs/util/binding-types.js:
  (* Riot WIP, @license MIT *)

@riotjs/util/objects.js:
  (* Riot WIP, @license MIT *)

@riotjs/dom-bindings/dist/esm.dom-bindings.js:
  (* Riot WIP, @license MIT *)

riot/esm/core/component-template-factory.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/core/bind-dom-node-to-component-instance.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/core/create-core-api-methods.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/core/create-pure-component.js:
  (* Riot v7.1.0, @license MIT *)

bianco.dom-to-array/index.next.js:
  (* Riot WIP, @license MIT *)

bianco.query/index.next.js:
  (* Riot WIP, @license MIT *)

riot/esm/core/component-dom-selectors.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/core/component-lifecycle-methods.js:
  (* Riot v7.1.0, @license MIT *)

bianco.attr/index.next.js:
  (* Riot WIP, @license MIT *)

riot/esm/core/css-manager.js:
  (* Riot v7.1.0, @license MIT *)

curri/index.next.js:
  (* Riot WIP, @license MIT *)

riot/esm/utils/dom.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/core/add-css-hook.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/core/compute-component-state.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/core/compute-initial-props.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/core/create-attribute-bindings.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/core/run-plugins.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/core/manage-component-lifecycle.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/core/instantiate-component.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/core/create-component-from-wrapper.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/api/register.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/api/unregister.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/core/mount-component.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/api/mount.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/api/unmount.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/api/install.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/api/uninstall.js:
  (* Riot v7.1.0, @license MIT *)

cumpa/index.next.js:
  (* Riot WIP, @license MIT *)

riot/esm/api/component.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/api/pure.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/api/with-types.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/api/version.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/api/__.js:
  (* Riot v7.1.0, @license MIT *)

riot/esm/riot.js:
  (* Riot v7.1.0, @license MIT *)
*/
